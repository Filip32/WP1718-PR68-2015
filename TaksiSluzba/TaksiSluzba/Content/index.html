<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="MainCss.css">
    <link rel="stylesheet" href="https://openlayers.org/en/v4.1.0/css/ol.css" type="text/css">
    <meta charset="utf-8" />
    <title>Taksi Sluzba</title>
    <script src="https://openlayers.org/en/v4.1.0/build/ol.js"></script>
    <script src="/Scripts/jquery-1.10.2.js"></script>
    <script src="/Scripts/FileHelper.js"></script>
    <script>
        $(document).ready(function () {
            var login_user;

            if (sessionStorage.getItem("loginuser") != null) {
                login_user = JSON.parse(sessionStorage.getItem("loginuser"));
            }

            if (sessionStorage.getItem("manu") != null) {
                $("#mainmanu").html(sessionStorage.getItem("manu"));
            }

            if (sessionStorage.getItem("screen") != null) {
                $("#screen").html(sessionStorage.getItem("screen"));
            }

            $(document).on("mouseover", "[name='menu']", function () {
                $(this).css("background-color", "#000080");
            });

            $(document).on("mouseout", "[name='menu']", function () {
                $(this).css("background-color", "blue");
            });

            $(document).on("click", "#register_in", function () {
                var error = "";
                if ($("#username").val() == "" || $("#password").val() == "" || $("#name").val() == "" ||
                    $("#lastname").val() == "" || $("#jmbg").val() == "" || $("#tel").val() == "" || $("#email").val() == "") {
                    error += "Sva polja moraju da budu popunjena. ";
                }

                var n = $("#jmbg").val().length;
                if (n != 13) {
                    error += " JMBG mora da ima 13 cifara";
                }

                $("#error1").text(error);

                if (error == "") {
                    let data = {
                        KorisnickoIme: $("#username").val(),
                        Lozinka: $("#password").val(),
                        Ime: $("#name").val(),
                        Prezime: $("#lastname").val(),
                        Pol: $("#pol").val(),
                        JMBG: $("#jmbg").val(),
                        Telefon: $("#tel").val(),
                        Email: $("#email").val()
                    }
                    $.post("/api/main/adduser", data).done(function (data, status) {
                        if (status == "success") {
                            sessionStorage.setItem("screen", textlog);
                            $("#screen").html(textlog);
                            $("#error1").text(data).css("color","CornflowerBlue");
                        }
                    });
                }
            });

            $(document).on("click", "#log_in", function () {

                if ($("#username").val() != "" && $("#password").val() != "") {
                    let data = {
                        username: $("#username").val(),
                        password: $("#password").val()
                    }
                    $.get("/api/main/loginuser", data).done(function (data, status) {
                        if (status == "success") {
                            if (data.KorisnickoIme == null)
                                $("#error1").text(data);
                            else {
                                login_user = data;
                                var t = "<table><tr>"
                                if (data.Uloga == 1) {
                                    t += t1;
                                }
                                else if (data.Uloga == 0) {
                                    t += t2;
                                }
                                else if (data.Uloga == 2) {
                                    t += t3;
                                }
                                t += "</tr></table>";
                                sessionStorage.setItem("manu", t);
                                $("#mainmanu").html(t);

                                var table = "<p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                                table += "<table border=\"1\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                                for (t in login_user.Voznje) {
                                    table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>" + login_user.Voznje[t].Odrediste + "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                                    if (login_user.Voznje[t].StatusVoznje == "1") {
                                        table += "Formirana";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "2") {
                                        table += "Obradjena";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "3") {
                                        table += "Prihvacena";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "4") {
                                        table += "Otkazana";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "5") {
                                        table += "Neuspesna";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "6") {
                                        table += "Uspesna";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "7") {
                                        table += "U_toku";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "0") {
                                        table += "Kreirana";
                                    }

                                    table += "</td><td><input type=\"submit\" id=\"obrada_voznje\" value=\"Obrada voznje\" /></td><td><input type=\"submit\" id=\"detalji_voznje\" value=\"Detalji voznje\" /></td></tr>";
                                }
                                table += "</table><br />";

                                if (login_user.Uloga == "1") {
                                    table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                                } else if (login_user.Uloga == "2") {
                                    table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                                }

                                table += pocetnastr;

                                if (login_user.Uloga == "1") {
                                    table += "<br />";
                                    table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                    table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                                    table += "<br />";
                                    table += "Pretraga po imenu i prezimenu vozača:<br />"
                                    table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                                }
                                else if (login_user.Uloga == "2") {
                                    table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                                }

                                table += "</div>";
                                sessionStorage.setItem("loginuser", JSON.stringify(data));
                                sessionStorage.setItem("screen", table);
                                $("#screen").html(table);
                            }
                        }
                    });
                }
                else {
                    $("#error1").text("Korisničko ime ili lozinka nisu uneti.");
                }

            });
            
            $(document).on("click", "#register", function () {
                sessionStorage.setItem("screen", textreg);
                $("#screen").html(textreg);
            });

            $(document).on("click", "#login", function () {
                sessionStorage.setItem("screen", textlog);
                $("#screen").html(textlog);
            });

            $(document).on("click", "#logout", function () {
                let un = { Username: login_user.KorisnickoIme };
                login_user = null;
                $.ajax({
                    url: "/api/main/logoutuser",
                    data: un,
                    type: "DELETE"              
                });

                sessionStorage.removeItem("loginuser");
                $("#mainmanu").html(menu);
                sessionStorage.setItem("screen", textlog);
                sessionStorage.setItem("manu", $("#mainmanu").html());
                $("#screen").html(textlog);
            });

            $(document).on("click", "#adddriver", function () {
                $("#screen").html(addDriver);
                sessionStorage.setItem("screen", addDriver);
            });

            $(document).on("click", "#add_driver_button", function () {
                var poruka = "";
                if ($("#username").val() == "" || $("#password").val() == "" || $("#name").val() == "" ||
                    $("#lastname").val() == "" || $("#jmbg").val() == "" || $("#tel").val() == "" ||
                    $("#email").val() == "" || $("#godiste").val() == "" || xx == null || yy == null ||
                    $("#tablice").val() == "") {
                    poruka = "Sva polja moraju biti popunjena i lokacija izabrana. ";
                }
                if ($("#jmbg").val().length != 13) {
                    poruka += "JMBG mora imati 13 brojeva.";
                }
                $("#error1").html(poruka);

                if (poruka == "") {
                    var sand = {
                        KorisnickoIme: $("#username").val(),
                        Lozinka: $("#password").val(),
                        Ime: $("#name").val(),
                        Prezime: $("#lastname").val(),
                        Pol: $("#pol").val(),
                        JMBG: $("#jmbg").val(),
                        Telefon: $("#tel").val(),
                        Email: $("#email").val(),
                        Lokacija:
                        {
                            XKordinata: xx,
                            YKordinata: yy,
                            Adresa:
                            {
                                Ulica_broj: ulica_broj,
                                Mesto: grad
                            }
                        },
                        Automobil:
                        {
                            GodisteAutomobila: $("#godiste").val(),
                            RegistarskaTablica: $("#tablice").val(),
                            TipVozila: $("#cartipe").val()
                        }
                    };

                    $.post("/api/main/adddriver", sand).done(function (data, status) {
                        if (status == "success") {
                            var table = "<div id=\"erorrr\">" + data + "</div><br /><p style=\"font-size:large; font-weight:bold\">Lista voznji<p><div>";
                            table += "<table border=\"1\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                            for (t in login_user.Voznje) {
                                table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka + "</td><td>" + login_user.Voznje[t].Odrediste + "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>" + login_user.Voznje[t].StatusVoznje + "</td><td><input type=\"submit\" id=\"obrada_voznje\" value=\"Obrada voznje\" /></td><td><input type=\"submit\" id=\"detalji_voznje\" value=\"Detalji voznje\" /></td></tr>";
                            }
                            table += "</table><br />";

                            if (login_user.Uloga == "1") {
                                table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                            } else if (login_user.Uloga == "2") {
                                table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                            }

                            table += pocetnastr;

                            if (login_user.Uloga == "1") {
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretraži\" /><br />";
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu vozača:<br />";
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretraži\" /><br />";
                            }

                            table += "</div>";
                            sessionStorage.setItem("screen", table);
                            $("#screen").html(table);
                        }
                    });
                }
            });

            $(document).on("click", "#home", function () {
                var  table = "<p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                table += "<table border=\"1\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                for (t in login_user.Voznje) {
                    table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>" + login_user.Voznje[t].Odrediste + "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                    if (login_user.Voznje[t].StatusVoznje == "1")
                    {
                        table += "Formirana";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "2") {
                        table += "Obradjena";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "3") {
                        table += "Prihvacena";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "4") {
                        table += "Otkazana";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "5") {
                        table += "Neuspesna";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "6") {
                        table += "Uspesna";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "7") {
                        table += "U_toku";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "0") {
                        table += "Kreirana";
                    }

                    table += "</td><td><input type=\"submit\" id=\"obrada_voznje\" value=\"Obrada voznje\" /></td><td><input type=\"submit\" id=\"detalji_voznje\" value=\"Detalji voznje\" /></td></tr>";
                }
                table += "</table><br />";

                if (login_user.Uloga == "1") {
                    table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                } else if (login_user.Uloga == "2") {
                    table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                }

                table += pocetnastr;

                if (login_user.Uloga == "1") {
                    table += "<br />";
                    table += "Pretraga po imenu i prezimenu mušterije:<br />";
                    table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretraži\" /><br />";
                    table += "<br />";
                    table += "Pretraga po imenu i prezimenu vozača:<br />"
                    table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretraži\" /><br />";
                }
                else if (login_user.Uloga == "2") {
                    table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                }

                table += "</div>";
                sessionStorage.setItem("screen", table);
                $("#screen").html(table);
            });

            $(document).on("click", "#profil", function () {
                var profil = "<div><div id= \"error1\" class=\"Red\" ></div > <p style=\"font-weight:bold; font-size:x-large\">Profil<\p>";
                profil += "<table><tr><td>Korisničko ime:</td><td> <input type=\"text\" id=\"username\" value=\"" + login_user.KorisnickoIme + "\"/></td></tr>";
                profil += "<tr><td>Lozinka: </td><td> <input type=\"password\" id=\"password\"value=\"" + login_user.Lozinka + "\" /> </td></tr>";
                profil += "<tr><td>Ime:</td><td> <input type=\"text\" id=\"name\" value=\"" + login_user.Ime + "\"/> </td></tr>";
                profil += "<tr><td>Prezime:</td><td> <input type=\"text\" id=\"lastname\" value=\"" + login_user.Prezime + "\"/> </td></tr>";
                profil += "<tr><td>Pol:</td><td> <select id=\"pol\" >";
                if (login_user.Pol == "Musko")
                    profil += "<option value=\"Musko\">Muško</option><option value=\"Zensko\">Žensko</option></select></td></tr>";
                else
                    profil += "<option value=\"Zensko\">Žensko</option><option value=\"Musko\">Muško</option></select></td></tr>";

                profil += "<tr><td>JMBG:</td><td> <input type=\"text\" id=\"jmbg\" value=\"" + login_user.JMBG + "\"/> </td></tr>";
                profil += "<tr><td>Kontakt telefon:</td><td> <input type=\"text\" id=\"tel\" value=\"" + login_user.Telefon + "\"/> </td></tr>";
                profil += "<tr><td>Email:</td><td> <input type=\"text\" id=\"email\" value=\"" + login_user.Email + "\"/> </td></tr>";

                if (login_user.Uloga == "2") {
                    if (login_user.Automobil.TipVozila == "0")
                        profil += "<tr><td>Tip automobila: </td><td> <select id=\"cartipe\"><option value=\"Putnicko_Vozilo\">Putničko vozilo</option><option value=\"Kombi_Vozilo\">Kombi vozilo</option></select></td></tr>";
                    else
                        profil += "<tr><td>Tip automobila: </td><td> <select id=\"cartipe\"><option value=\"Kombi_Vozilo\">Kombi vozilo</option><option value=\"Putnicko_Vozilo\">Putničko vozilo</option></select></td></tr>";

                    profil += "<tr><td>Godište automobila: </td><td> <input type=\"text\" value=\"" + login_user.Automobil.GodisteAutomobila + "\" id=\"godiste\" /> </td></tr>";
                    profil += "<tr><td>Broj tablica:</td><td><input type=\"text\" value=\"" + login_user.Automobil.RegistarskaTablica + "\" id=\"tablice\" /> <br /></td></tr>";
                    profil += "<tr><td>Lokacija:<br /></td><td><p id=\"kord\">[" + login_user.Lokacija.Adresa.Ulica_broj + "," + login_user.Lokacija.Adresa.Mesto + "]</p></td></tr></table>";
                    var mapa = "<div id=\"map\" style=\"height:400px; text-align: center; width:50%\" class=\"map\"></div><script>";
                    mapa += "var xx; var yy; var ulica_broj; var grad;";
                    mapa += "function reverseGeocode(coords) {";
                    mapa += "fetch('http://nominatim.openstreetmap.org/reverse?format=json&lon=' + coords[0] + '&lat=' + coords[1])";
                    mapa += ".then(function(response) {return response.json();}).then(function(json) {var add = json.address;console.log(add);";
                    mapa += "ulica_broj = add.road; if(add.house_number != null){ulica_broj += \" \"+add.house_number;}grad = add.city + \" \" + add.postcode; $(\"#kord\").html(\"[\" + ulica_broj +\" , \"+ grad + \"]\");});}";
                    mapa += "var map = new ol.Map({layers: [new ol.layer.Tile({";
                    mapa += "source: new ol.source.OSM()})],target: 'map',view: new ol.View({";
                    mapa += "center: [2209717.3810248757,5660306.884676355],zoom: 19})});";
                    mapa += "map.on('dblclick', function (evt) {var coord = ol.proj.toLonLat(evt.coordinate); reverseGeocode(coord);";
                    mapa += " xx = coord[0]; yy = coord[1];});";
                    mapa += "<\/script>";
                    profil += mapa;
                }
                else {
                    profil += "</table >";
                }
                profil += "<br /><br /><input type=\"submit\" id=\"update_profile\" value=\"Ažuriraj\" /></div>";
                sessionStorage.setItem("screen", profil);
                $("#screen").html(profil);
            });

            $(document).on("click", "#update_profile", function () {
                var poruka = "";
                if (login_user.Uloga == "2") {
                    if ($("#username").val() == "" || $("#password").val() == "" || $("#name").val() == "" ||
                        $("#lastname").val() == "" || $("#jmbg").val() == "" || $("#tel").val() == "" ||
                        $("#email").val() == "" || $("#godiste").val() == "" ||
                        $("#tablice").val() == "") {
                        poruka = "Sva polja moraju biti popunjena i lokacija izabrana. ";
                    }
                    if (xx == null && yy == null) {
                        xx = login_user.Lokacija.XKordinata;
                        yy = login_user.Lokacija.YKordinata;
                        ulica_broj = login_user.Lokacija.Adresa.Ulica_broj;
                        grad = login_user.Lokacija.Adresa.Mesto;
                    }
                }
                else {
                    if ($("#username").val() == "" || $("#password").val() == "" || $("#name").val() == "" ||
                        $("#lastname").val() == "" || $("#jmbg").val() == "" || $("#tel").val() == "" ||
                        $("#email").val() == "") {
                        poruka = "Sva polja moraju biti popunjena. ";
                    }
                }
                if ($("#jmbg").val().length != 13) {
                    poruka += "JMBG mora imati 13 brojeva.";
                }

                $("#error1").html(poruka);

                if (poruka == "") {
                    if (login_user.Uloga == "2") {
                        var sand = {
                            Id: login_user.Id,
                            KorisnickoIme: $("#username").val(),
                            Lozinka: $("#password").val(),
                            Ime: $("#name").val(),
                            Prezime: $("#lastname").val(),
                            Pol: $("#pol").val(),
                            JMBG: $("#jmbg").val(),
                            Telefon: $("#tel").val(),
                            Email: $("#email").val(),
                            Uloga: "Vozac",
                            Lokacija:
                            {
                                XKordinata: xx,
                                YKordinata: yy,
                                Adresa:
                                {
                                    Ulica_broj: ulica_broj,
                                    Mesto: grad
                                }
                            },
                            Voznje: login_user.Voznje,
                            Automobil:
                            {
                                GodisteAutomobila: $("#godiste").val(),
                                RegistarskaTablica: $("#tablice").val(),
                                TipVozila: $("#cartipe").val()
                            }
                        };
                    }
                    else {
                        var sand = {
                            Id: login_user.Id,
                            KorisnickoIme: $("#username").val(),
                            Lozinka: $("#password").val(),
                            Ime: $("#name").val(),
                            Prezime: $("#lastname").val(),
                            Pol: $("#pol").val(),
                            JMBG: $("#jmbg").val(),
                            Telefon: $("#tel").val(),
                            Email: $("#email").val(),
                            Uloga: login_user.Uloga,
                            Voznje: login_user.Voznje
                        };
                    }

                    $.post("/api/main/updateprofile", sand,function (data, status) {
                        if (status == "success") {
                            if (data == "Uspešno ažuriran profil.") {
                                if (login_user.Uloga == "2") {
                                    login_user.KorisnickoIme = $("#username").val();
                                    login_user.Lozinka = $("#password").val();
                                    login_user.Ime = $("#name").val();
                                    login_user.Prezime = $("#lastname").val();
                                    login_user.Pol = $("#pol").val();
                                    login_user.Email = $("#email").val();
                                    login_user.JMBG = $("#jmbg").val();
                                    login_user.Telefon = $("#tel").val();
                                    login_user.Lokacija.XKordinata = xx;
                                    login_user.Lokacija.YKordinata = yy;
                                    login_user.Lokacija.Adresa.Ulica_broj = ulica_broj;
                                    login_user.Lokacija.Adresa.Mesto = grad;
                                    login_user.Automobil.GodisteAutomobila = $("#godiste").val();
                                    login_user.Automobil.RegistarskaTablica = $("#tablice").val();
                                    login_user.Automobil.TipVozila = $("#cartipe").val();
                                } else
                                {
                                    login_user.KorisnickoIme = $("#username").val();
                                    login_user.Lozinka = $("#password").val();
                                    login_user.Ime = $("#name").val();
                                    login_user.Prezime = $("#lastname").val();
                                    login_user.Pol = $("#pol").val();
                                    login_user.Email = $("#email").val();
                                    login_user.JMBG = $("#jmbg").val();
                                    login_user.Telefon = $("#tel").val();
                                    login_user.Uloga = login_user.Uloga;
                                }
                            }
                            var table = "<div id=\"erorrr\">" + data + "</div><br /><p style=\"font-size:large; font-weight:bold\">Lista voznji<p><div>";
                            table += "<table border=\"1\"><tr><th>Polazna tačka</th><th>Odrediste</th><th>Musterija</th><th>Vozač</th><th>Dispečer</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                            for (t in login_user.Voznje) {
                                table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>" + login_user.Voznje[t].Odrediste + "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                                if (login_user.Voznje[t].StatusVoznje == "1") {
                                    table += "Formirana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "2") {
                                    table += "Obradjena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "3") {
                                    table += "Prihvacena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "4") {
                                    table += "Otkazana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "5") {
                                    table += "Neuspesna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "6") {
                                    table += "Uspesna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "7") {
                                    table += "U_toku";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "0") {
                                    table += "Kreirana";
                                }

                                table += "</td><td><input type=\"submit\" id=\"obrada_voznje\" value=\"Obrada voznje\" /></td><td><input type=\"submit\" id=\"detalji_voznje\" value=\"Detalji voznje\" /></td></tr>";
                            }
                            table += "</table><br />";

                            if (login_user.Uloga == "1") {
                                table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                            } else if (login_user.Uloga == "2") {
                                table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                            }

                            table += pocetnastr;

                            if (login_user.Uloga == "1") {
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretraži\" /><br />";
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu vozača:<br />";
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretraži\" /><br />";
                            }

                            table += "</div>";
                            sessionStorage.removeItem("loginuser");
                            sessionStorage.setItem("loginuser", JSON.stringify(login_user));
                            sessionStorage.setItem("screen", table);
                            $("#screen").html(table);
                        }
                    });
                }
            });

            $(document).on("click", "#adddrive", function () {
                var addDrive = "<div><div id= \"error1\" class=\"Red\" ></div ><p style=\"font-weight:bold; font-size:x-large\">Dodaj vožnju<\p>";
                addDrive = "<p id=\"greskavoznja\" class=\"Red\"></p><br />Polazište:<br />";
                addDrive += "<p id=\"kord\"></p>";
                var mapa = "<div id=\"map\" style=\"height:400px; text-align: center; width:50%\" class=\"map\"></div><script>";
                mapa += "var xx; var yy; var ulica_broj; var grad;";
                mapa += "function reverseGeocode(coords) {";
                mapa += "fetch('http://nominatim.openstreetmap.org/reverse?format=json&lon=' + coords[0] + '&lat=' + coords[1])";
                mapa += ".then(function(response) {return response.json();}).then(function(json) {var add = json.address;console.log(add);";
                mapa += "ulica_broj = add.road; if(add.house_number != null){ulica_broj += \" \"+add.house_number;}grad = add.city + \" \" + add.postcode; $(\"#kord\").html(\"[\" + ulica_broj +\" , \"+ grad + \"]\");});}";
                mapa += "var map = new ol.Map({layers: [new ol.layer.Tile({";
                mapa += "source: new ol.source.OSM()})],target: 'map',view: new ol.View({";
                mapa += "center: [2209717.3810248757,5660306.884676355],zoom: 19})});";
                mapa += "map.on('dblclick', function (evt) {var coord = ol.proj.toLonLat(evt.coordinate); reverseGeocode(coord);";
                mapa += " xx = coord[0]; yy = coord[1];});";
                mapa += "<\/script>";
                addDrive += mapa;
                addDrive += "<br /><br />Tip automobila: &nbsp;&nbsp;";
                addDrive += "<select id=\"cartipe\"><option value=\"Putnicko_Vozilo\">Putničko vozilo</option><option value=\"Kombi_Vozilo\">Kombi vozilo</option></select><br /><br />";

                if (login_user.Uloga == "1") {
                    addDrive += "Izabrati vozača: &nbsp;&nbsp;";
                    addDrive += "<select id=\"vozaci\">";
                    addDrive += "</select><br /><br />";
                }
                addDrive += "<input type=\"submit\" id=\"add_drive_button\" value=\"Dodaj Vožnju\" /></div>";
                sessionStorage.setItem("screen", addDrive);
                $("#screen").html(addDrive);
            });

            $(document).on("click", "#dodrive", function () {

                var blok = "<div><div id= \"error1\" class=\"Red\" ></div > <p style=\"font-weight:bold; font-size:x-large\">Blokirani<\p>";
                //get metoda za listu blokiranih
                blok += "<table border=\"1\"><tr><td>Korisnicko ime</td><td>Uloga</td><td>&nbsp;</td></tr>";
                /* for(k in blokirani)
                 {
                     blok += "<tr><td>" + blokirani.KorisnickoIme + "</td><td>";
                     if (blokirani.Uloga == "2")
                         blok += "Vozac</td>";
                     else
                         blok += "Musterija";

                     blok += "<td><input type=\"hidden\" id=\"hiddenname\" value=\"" + blokirani.KorisnickoIme + "\"><input type=\"submit\" id=\"odblokiraj\" value=\"Odblokiraj\"></td></tr>";
                 }*/

                blok += "</table><br/><br/><p style=\"font-weight:bold; font-size:large\">Blokirati unosom korisnickog imena<\p>";
                blok += "<input type=\"text\" id=\"blokirajpoimenu\"> &nbsp;&nbsp;<input type=\"submit\" id=\"blokiraj\" value=\"Blokiraj\">";
                sessionStorage.setItem("screen", blok);
                $("#screen").html(blok);
            });

            $(document).on("dblclick", "#map", function ()
            {
                if (login_user.Uloga == "1") {
                    var xcord = xx;
                    var ycord = yy;
                    if (xcord != null && ycord != null) {
                        var cords = {
                            x: xcord,
                            y: ycord
                        };
                        $.get("/api/main/get5closest", cords).done(function (data, status) {
                            if (status == "success") {
                                var driver = eval(data);

                                var por = "";
                                for (var key in data) {
                                    por += "<option value=\"" + key + "\">" + data[key] + "</option>";
                                }
                                $("#vozaci").html(por);
                            }
                        });
                    }
                }
            });

            $(document).on("click", "#add_drive_button", function ()
            {
                if (xx == null && yy == null) {
                    $("#greskavoznja").html("Sva polja moraju biti popunjena.");
                }
                else {
                    if (login_user.Uloga == "1") {
                        var message =
                            {
                                PolaznaTacka:
                                {
                                    XKordinata: xx,
                                    YKordinata: yy,
                                    Adresa:
                                    {
                                        Ulica_broj: ulica_broj,
                                        Mesto: grad
                                    }
                                },
                                TipVozila: $("#cartipe").val(),
                                Dispecer: login_user.Id,
                                Vozac: $("#vozaci").val()

                            };
                    } else {
                        var message =
                            {
                                PolaznaTacka:
                                {
                                    XKordinata: xx,
                                    YKordinata: yy,
                                    Adresa:
                                    {
                                        Ulica_broj: ulica_broj,
                                        Mesto: grad
                                    }
                                },
                                TipVozila: $("#cartipe").val(),
                                Musterija: login_user.Id
                            };
                    }

                    $.post("/api/main/adddriveto", message, function (data, status){
                        if (status == "success") {
                            login_user = data;
                            sessionStorage.removeItem("loginuser");
                            sessionStorage.setItem("loginuser", JSON.stringify(login_user));

                            var table = "<p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                            table += "<table border=\"1\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                            for (t in login_user.Voznje) {
                                table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>" + login_user.Voznje[t].Odrediste + "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                                if (login_user.Voznje[t].StatusVoznje == "1") {
                                    table += "Formirana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "2") {
                                    table += "Obradjena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "3") {
                                    table += "Prihvacena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "4") {
                                    table += "Otkazana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "5") {
                                    table += "Neuspesna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "6") {
                                    table += "Uspesna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "7") {
                                    table += "U_toku";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "0") {
                                    table += "Kreirana";
                                }

                                table += "</td><td><input type=\"submit\" id=\"obrada_voznje\" value=\"Obrada voznje\" /></td><td><input type=\"submit\" id=\"detalji_voznje\" value=\"Detalji voznje\" /></td></tr>";
                            }
                            table += "</table><br />";

                            if (login_user.Uloga == "1") {
                                table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                            } else if (login_user.Uloga == "2") {
                                table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                            }

                            table += pocetnastr;

                            if (login_user.Uloga == "1") {
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretraži\" /><br />";
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu vozača:<br />"
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretraži\" /><br />";
                            }
                            else if (login_user.Uloga == "2") {
                                table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                            }

                            table += "</div>";
                            sessionStorage.setItem("screen", table);
                            $("#screen").html(table);

                        }
                    });

                }
            });
        });
    </script>
</head>
<body>
    <div class="Naslov">Taksi služba</div>
    <div id="mainmanu" class="Meni">
        <table>
            <tr>
                <td name="menu" id="login">Uloguj se</td>
                <td>|</td>
                <td name="menu" id="register">Registracija</td>
            </tr>
        </table>
    </div>
      
    <br /><br /><br />
    <div id="screen">
    <div class="Centar" id="screenin">
          <div id="error1" class="Red"></div>
          Korisničko ime:<br /> <input type="text" id="username" /><br />
          Lozinka:<br /> <input type="password" id="password" /><br />
          <input type="submit" id="log_in" value="Uloguj se" />
    </div>
    </div>
</body>
</html>