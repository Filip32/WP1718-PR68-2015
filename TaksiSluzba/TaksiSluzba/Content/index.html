<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="MainCss.css">
    <link rel="stylesheet" href="https://openlayers.org/en/v4.1.0/css/ol.css" type="text/css">
    <meta charset="utf-8" />
    <title>Taksi Sluzba</title>
    <script src="https://openlayers.org/en/v4.1.0/build/ol.js"></script>
    <script src="/Scripts/jquery-1.10.2.js"></script>
    <script src="/Scripts/FileHelper.js"></script>
    <script>
        $(document).ready(function () {
            if (localStorage.getItem("manu") != null) {
                $("#mainmanu").html(localStorage.getItem("manu"));
            }

            if (localStorage.getItem("screen") != null) {
                $("#screen").html(localStorage.getItem("screen"));
            }

            $(document).on("mouseover", "[name='menu']", function () {
                $(this).css("background-color", "#000080");
            });

            $(document).on("mouseout", "[name='menu']", function () {
                $(this).css("background-color", "blue");
            });

            $(document).on("click", "#register_in", function () {
                var error = "";
                if ($("#username").val() == "" || $("#password").val() == "" || $("#name").val() == "" ||
                    $("#lastname").val() == "" || $("#jmbg").val() == "" || $("#tel").val() == "" || $("#email").val() == "") {
                    error += "Sva polja moraju da budu popunjena. ";
                }

                var n = $("#jmbg").val().length;
                if (n != 13) {
                    error += " JMBG mora da ima 13 cifara";
                }

                $("#error1").text(error);

                if (error == "") {
                    let data = {
                        KorisnickoIme: $("#username").val(),
                        Lozinka: $("#password").val(),
                        Ime: $("#name").val(),
                        Prezime: $("#lastname").val(),
                        Pol: $("#pol").val(),
                        JMBG: $("#jmbg").val(),
                        Telefon: $("#tel").val(),
                        Email: $("#email").val()
                    }
                    $.post("/api/main/adduser", data).done(function (data, status) {
                        if (status == "success") {
                            localStorage.setItem("screen", textlog);
                            $("#screen").html(textlog);
                            $("#error1").text(data).css("color","CornflowerBlue");
                        }
                    });
                }
            });

            $(document).on("click", "#log_in", function () {

                if ($("#username").val() != "" && $("#password").val() != "") {
                    let data = {
                        username: $("#username").val(),
                        password: $("#password").val()
                    }
                    $.get("/api/main/loginuser", data).done(function (data, status) {
                        if (status == "success") {
                            localStorage.removeItem("sveVoznje");
                            localStorage.removeItem("slobodneVoznje");
                            localStorage.removeItem("pretraga");
                            if (data.KorisnickoIme == null)
                                $("#error1").text(data);
                            else {
                                var t = "<table><tr>"
                                if (data.Uloga == 1) {
                                    t += t1;
                                }
                                else if (data.Uloga == 0) {
                                    t += t2;
                                }
                                else if (data.Uloga == 2) {
                                    t += t3;
                                }
                                t += "</tr></table>";
                                localStorage.setItem("manu", t);
                                $("#mainmanu").html(t);

                                var table = "<div id=\"erorrr\"></div><p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                                table += "<input type=\"submit\" id=\"reset\" value=\"Reset tabele\" /><br /><br />";
                                table += "<table border=\"1\" id=\"maintable\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                                for (t in data.Voznje) {
                                    table += "<tr><td>" + data.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                                    if (data.Voznje[t].Odrediste != null)
                                        table += data.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + data.Voznje[t].Odrediste.Adresa.Mesto;
                                    else
                                        table += "null";
                                    table += "</td><td>" + data.Voznje[t].Musterija + "</td><td>" + data.Voznje[t].Vozac + "</td><td>" + data.Voznje[t].Dispecer + "</td><td>";

                                    var date = data.Voznje[t].VremePorudjbine.split("T");
                                    var time = date[1].split(".");
                                    table += date[0] + " ~ " + time[0];

                                    table += "</td><td>" + data.Voznje[t].Iznos + "</td><td>";
                                    if (data.Voznje[t].Komentar != null)
                                        if (data.Voznje[t].Komentar.OcenaVoznje != null)
                                            table += data.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                                        else
                                            table += "0</td><td>";
                                    else
                                        table += "0</td><td>";

                                    if (data.Voznje[t].StatusVoznje == "1") {
                                        table += "Formirana";
                                    }
                                    else if (data.Voznje[t].StatusVoznje == "2") {
                                        table += "Obrađena";
                                    }
                                    else if (data.Voznje[t].StatusVoznje == "3") {
                                        table += "Prihvaćena";
                                    }
                                    else if (data.Voznje[t].StatusVoznje == "4") {
                                        table += "Otkazana";
                                    }
                                    else if (data.Voznje[t].StatusVoznje == "5") {
                                        table += "Neuspešna";
                                    }
                                    else if (data.Voznje[t].StatusVoznje == "6") {
                                        table += "Uspešna";
                                    }
                                    else if (data.Voznje[t].StatusVoznje == "0") {
                                        table += "Kreirana";
                                    }

                                    table += "</td><td><input type=\"submit\"";
                                    if (data.Uloga == "1")
                                        if (data.Voznje[t].StatusVoznje != "0")
                                            table += " disabled ";
                                    if (data.Uloga == "0")
                                        if (data.Voznje[t].StatusVoznje == "2" || data.Voznje[t].StatusVoznje == "3" || data.Voznje[t].StatusVoznje == "4" || data.Voznje[t].StatusVoznje == "5")
                                            table += " disabled ";
                                    if (data.Uloga == "2")
                                        if (data.Voznje[t].StatusVoznje == "6" || data.Voznje[t].StatusVoznje == "5")
                                            table += " disabled ";
                                    table += "name=\"obrada_voznje\" id=\"" + data.Voznje[t].Id + "\" value=\"";
                                    if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                        table += "Preuzmi";
                                    else
                                        table += "Obrada vožnje";
                                    table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                                }
                                table += "</table><br />";

                                if (data.Uloga == "1") {
                                    table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                                } else if (data.Uloga == "2") {
                                    table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                                }

                                table += pocetnastr;

                                if (data.Uloga == "1") {
                                    table += "<br />";
                                    table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                    table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                                    table += "<br />";
                                    table += "Pretraga po imenu i prezimenu vozača:<br />"
                                    table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                                }
                                else if (data.Uloga == "2") {
                                    table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                                }

                                table += "</div>";
                                localStorage.setItem("loginuser", JSON.stringify(data));
                                localStorage.setItem("screen", table);
                                $("#screen").html(table);
                            }
                        }
                    });
                }
                else {
                    $("#error1").text("Korisničko ime ili lozinka nisu uneti.");
                }

            });
            
            $(document).on("click", "#register", function () {
                localStorage.setItem("screen", textreg);
                $("#screen").html(textreg);
            });

            $(document).on("click", "#login", function () {
                localStorage.setItem("screen", textlog);
                $("#screen").html(textlog);
            });

            $(document).on("click", "#logout", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                let un = { Username: login_user.KorisnickoIme };
                $.ajax({
                    url: "/api/main/logoutuser",
                    data: un,
                    type: "DELETE"              
                });
                localStorage.removeItem("sveVoznje");
                localStorage.removeItem("slobodneVoznje");
                localStorage.removeItem("pretraga");
                localStorage.removeItem("loginuser");
                $("#mainmanu").html(menu);
                localStorage.setItem("screen", textlog);
                localStorage.setItem("manu", $("#mainmanu").html());
                $("#screen").html(textlog);
            });

            $(document).on("click", "#adddriver", function () {
                localStorage.removeItem("sveVoznje");
                localStorage.removeItem("slobodneVoznje");
                localStorage.removeItem("pretraga");
                $("#screen").html(addDriver);
                localStorage.setItem("screen", addDriver);
            });

            $(document).on("click", "#add_driver_button", function () {
                var poruka = "";
                if ($("#username").val() == "" || $("#password").val() == "" || $("#name").val() == "" ||
                    $("#lastname").val() == "" || $("#jmbg").val() == "" || $("#tel").val() == "" ||
                    $("#email").val() == "" || $("#godiste").val() == "" || xx == null || yy == null ||
                    $("#tablice").val() == "") {
                    poruka = "Sva polja moraju biti popunjena i lokacija izabrana. ";
                }
                if ($("#jmbg").val().length != 13) {
                    poruka += "JMBG mora imati 13 brojeva.";
                }
                $("#error1").html(poruka);

                if (poruka == "") {
                    var sand = {
                        KorisnickoIme: $("#username").val(),
                        Lozinka: $("#password").val(),
                        Ime: $("#name").val(),
                        Prezime: $("#lastname").val(),
                        Pol: $("#pol").val(),
                        JMBG: $("#jmbg").val(),
                        Telefon: $("#tel").val(),
                        Email: $("#email").val(),
                        Lokacija:
                        {
                            XKordinata: xx,
                            YKordinata: yy,
                            Adresa:
                            {
                                Ulica_broj: ulica_broj,
                                Mesto: grad
                            }
                        },
                        Automobil:
                        {
                            GodisteAutomobila: $("#godiste").val(),
                            RegistarskaTablica: $("#tablice").val(),
                            TipVozila: $("#cartipe").val()
                        }
                    };

                    $.post("/api/main/adddriver", sand).done(function (data, status) {
                        if (status == "success") {
                            var login_user = JSON.parse(localStorage.getItem("loginuser"));
                            var table = "<div id=\"erorrr\">" + data + "</div><br /><p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                            table += "<input type=\"submit\" id=\"reset\" value=\"Reset tabele\" /><br /><br />";
                            table += "<table border=\"1\" id=\"maintable\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                            for (t in login_user.Voznje) {
                                table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                                if (login_user.Voznje[t].Odrediste != null)
                                    table += login_user.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + login_user.Voznje[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                                table += "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                                var date = login_user.Voznje[t].VremePorudjbine.split("T");
                                var time = date[1].split(".");
                                table += date[0] + " ~ " + time[0];

                                table += "</td><td>" + login_user.Voznje[t].Iznos + "</td><td>";
                                if (login_user.Voznje[t].Komentar != null)
                                    if (login_user.Voznje[t].Komentar.OcenaVoznje != null)
                                        table += login_user.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                                    else
                                        table += "0</td><td>";
                                else
                                    table += "0</td><td>";

                                if (login_user.Voznje[t].StatusVoznje == "1") {
                                    table += "Formirana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "2") {
                                    table += "Obrađena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "3") {
                                    table += "Prihvaćena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "4") {
                                    table += "Otkazana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "5") {
                                    table += "Neuspešna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "6") {
                                    table += "Uspešna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "0") {
                                    table += "Kreirana";
                                }

                                table += "</td><td><input type=\"submit\"";
                                if (login_user.Uloga == "1")
                                    if (login_user.Voznje[t].StatusVoznje != "0")
                                        table += " disabled ";
                                if (login_user.Uloga == "0")
                                    if (login_user.Voznje[t].StatusVoznje == "2" || login_user.Voznje[t].StatusVoznje == "3" || login_user.Voznje[t].StatusVoznje == "4" || login_user.Voznje[t].StatusVoznje == "5")
                                        table += " disabled ";
                                if (login_user.Uloga == "2")
                                    if (login_user.Voznje[t].StatusVoznje == "6" || login_user.Voznje[t].StatusVoznje == "5")
                                        table += " disabled ";
                                table += "name=\"obrada_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"";
                                if (login_user.Uloga == "2" && login_user.Voznje[t].StatusVoznje == "0")
                                    table += "Preuzmi";
                                else
                                    table += "Obrada vožnje";
                                table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                            }
                            table += "</table><br />";

                            if (login_user.Uloga == "1") {
                                table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                            } else if (login_user.Uloga == "2") {
                                table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                            }

                            table += pocetnastr;

                            if (login_user.Uloga == "1") {
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu vozača:<br />"
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                            }
                            else if (login_user.Uloga == "2") {
                                table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                            }

                            table += "</div>";
                            localStorage.setItem("loginuser", JSON.stringify(login_user));
                            localStorage.setItem("screen", table);
                            $("#screen").html(table);
                        }
                    });
                }
            });

            $(document).on("click", "#home", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                localStorage.removeItem("sveVoznje");
                localStorage.removeItem("slobodneVoznje");
                localStorage.removeItem("pretraga");
                var table = "<div id=\"erorrr\"></div><br /><p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                table += "<input type=\"submit\" id=\"reset\" value=\"Reset tabele\" /><br /><br />";
                table += "<table border=\"1\" id=\"maintable\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                  for (t in login_user.Voznje) {
                    table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                    if (login_user.Voznje[t].Odrediste != null)
                        table += login_user.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + login_user.Voznje[t].Odrediste.Adresa.Mesto;
                    else
                        table += "null";
                    table += "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                    var date = login_user.Voznje[t].VremePorudjbine.split("T");
                    var time = date[1].split(".");
                    table += date[0] + " ~ " + time[0];

                    table += "</td><td>" + login_user.Voznje[t].Iznos + "</td><td>";
                    if (login_user.Voznje[t].Komentar != null)
                        if (login_user.Voznje[t].Komentar.OcenaVoznje != null)
                            table += login_user.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                        else
                            table += "0</td><td>";
                    else
                        table += "0</td><td>";

                    if (login_user.Voznje[t].StatusVoznje == "1") {
                        table += "Formirana";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "2") {
                        table += "Obrađena";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "3") {
                        table += "Prihvaćena";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "4") {
                        table += "Otkazana";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "5") {
                        table += "Neuspešna";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "6") {
                        table += "Uspešna";
                    }
                    else if (login_user.Voznje[t].StatusVoznje == "0") {
                        table += "Kreirana";
                    }

                    table += "</td><td><input type=\"submit\"";
                    if (login_user.Uloga == "1")
                        if (login_user.Voznje[t].StatusVoznje != "0")
                            table += " disabled ";
                    if (login_user.Uloga == "0")
                        if (login_user.Voznje[t].StatusVoznje == "2" || login_user.Voznje[t].StatusVoznje == "3" || login_user.Voznje[t].StatusVoznje == "4" || login_user.Voznje[t].StatusVoznje == "5")
                            table += " disabled ";
                    if (login_user.Uloga == "2")
                        if (login_user.Voznje[t].StatusVoznje == "6" || login_user.Voznje[t].StatusVoznje == "5")
                            table += " disabled ";
                    table += "name=\"obrada_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"";
                    if (login_user.Uloga == "2" && login_user.Voznje[t].StatusVoznje == "0")
                        table += "Preuzmi";
                    else
                        table += "Obrada vožnje";
                    table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                }
                table += "</table><br />";

                if (login_user.Uloga == "1") {
                    table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                } else if (login_user.Uloga == "2") {
                    table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                }

                table += pocetnastr;

                if (login_user.Uloga == "1") {
                    table += "<br />";
                    table += "Pretraga po imenu i prezimenu mušterije:<br />";
                    table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                    table += "<br />";
                    table += "Pretraga po imenu i prezimenu vozača:<br />"
                    table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                }
                else if (login_user.Uloga == "2") {
                    table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                }

                table += "</div>";
                localStorage.setItem("loginuser", JSON.stringify(login_user));
                localStorage.setItem("screen", table);
                $("#screen").html(table);
            });

            $(document).on("click", "#profil", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                localStorage.removeItem("sveVoznje");
                localStorage.removeItem("slobodneVoznje");
                localStorage.removeItem("pretraga");
                var profil = "<div><div id= \"error1\" class=\"Red\" ></div > <p style=\"font-weight:bold; font-size:x-large\">Profil<\p>";
                profil += "<table><tr><td>Korisničko ime:</td><td> <input type=\"text\" id=\"username\" value=\"" + login_user.KorisnickoIme + "\"/></td></tr>";
                profil += "<tr><td>Lozinka: </td><td> <input type=\"password\" id=\"password\"value=\"" + login_user.Lozinka + "\" /> </td></tr>";
                profil += "<tr><td>Ime:</td><td> <input type=\"text\" id=\"name\" value=\"" + login_user.Ime + "\"/> </td></tr>";
                profil += "<tr><td>Prezime:</td><td> <input type=\"text\" id=\"lastname\" value=\"" + login_user.Prezime + "\"/> </td></tr>";
                profil += "<tr><td>Pol:</td><td> <select id=\"pol\" >";
                if (login_user.Pol == "Musko")
                    profil += "<option value=\"Musko\">Muško</option><option value=\"Zensko\">Žensko</option></select></td></tr>";
                else
                    profil += "<option value=\"Zensko\">Žensko</option><option value=\"Musko\">Muško</option></select></td></tr>";

                profil += "<tr><td>JMBG:</td><td> <input type=\"text\" id=\"jmbg\" value=\"" + login_user.JMBG + "\"/> </td></tr>";
                profil += "<tr><td>Kontakt telefon:</td><td> <input type=\"text\" id=\"tel\" value=\"" + login_user.Telefon + "\"/> </td></tr>";
                profil += "<tr><td>Email:</td><td> <input type=\"text\" id=\"email\" value=\"" + login_user.Email + "\"/> </td></tr>";

                if (login_user.Uloga == "2") {
                    if (login_user.Automobil.TipVozila == "0")
                        profil += "<tr><td>Tip automobila: </td><td> <select id=\"cartipe\"><option value=\"Putnicko_Vozilo\">Putničko vozilo</option><option value=\"Kombi_Vozilo\">Kombi vozilo</option></select></td></tr>";
                    else
                        profil += "<tr><td>Tip automobila: </td><td> <select id=\"cartipe\"><option value=\"Kombi_Vozilo\">Kombi vozilo</option><option value=\"Putnicko_Vozilo\">Putničko vozilo</option></select></td></tr>";

                    profil += "<tr><td>Godište automobila: </td><td> <input type=\"text\" value=\"" + login_user.Automobil.GodisteAutomobila + "\" id=\"godiste\" /> </td></tr>";
                    profil += "<tr><td>Broj tablica:</td><td><input type=\"text\" value=\"" + login_user.Automobil.RegistarskaTablica + "\" id=\"tablice\" /> <br /></td></tr>";
                    profil += "<tr><td>Lokacija:<br /></td><td><p id=\"kord\">[" + login_user.Lokacija.Adresa.Ulica_broj + "," + login_user.Lokacija.Adresa.Mesto + "]</p></td></tr></table>";
                    var mapa = "<div id=\"map\" style=\"height:400px; text-align: center; width:50%\" class=\"map\"></div><script>";
                    mapa += "var xx; var yy; var ulica_broj; var grad;";
                    mapa += "function reverseGeocode(coords) {";
                    mapa += "fetch('http://nominatim.openstreetmap.org/reverse?format=json&lon=' + coords[0] + '&lat=' + coords[1])";
                    mapa += ".then(function(response) {return response.json();}).then(function(json) {var add = json.address;console.log(add);";
                    mapa += "ulica_broj = add.road; if(add.house_number != null){ulica_broj += \" \"+add.house_number;}grad = add.city + \" \" + add.postcode; $(\"#kord\").html(\"[\" + ulica_broj +\" , \"+ grad + \"]\");});}";
                    mapa += "var map = new ol.Map({layers: [new ol.layer.Tile({";
                    mapa += "source: new ol.source.OSM()})],target: 'map',view: new ol.View({";
                    mapa += "center: [2209717.3810248757,5660306.884676355],zoom: 19})});";
                    mapa += "map.on('dblclick', function (evt) {var coord = ol.proj.toLonLat(evt.coordinate); reverseGeocode(coord);";
                    mapa += " xx = coord[0]; yy = coord[1];});";
                    mapa += "<\/script>";
                    profil += mapa;
                }
                else {
                    profil += "</table >";
                }
                profil += "<br /><br /><input type=\"submit\" id=\"update_profile\" value=\"Ažuriraj\" /></div>";
                localStorage.setItem("screen", profil);
                $("#screen").html(profil);
            });

            $(document).on("click", "#update_profile", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));

                    let data = { Id: login_user.Id };
                    $.get("/api/main/isitblocked", data, function (data, status) {
                        if (status == "success") {
                            if (data == "true") {
                                localStorage.removeItem("loginuser");
                                $("#mainmanu").html(menu);
                                localStorage.setItem("screen", textlog);
                                localStorage.setItem("manu", $("#mainmanu").html());
                                $("#screen").html(textlog);
                                $("#error1").html("Blokirani ste.");
                            }
                            else
                            {
                var poruka = "";
                if (login_user.Uloga == "2") {
                    if ($("#username").val() == "" || $("#password").val() == "" || $("#name").val() == "" ||
                        $("#lastname").val() == "" || $("#jmbg").val() == "" || $("#tel").val() == "" ||
                        $("#email").val() == "" || $("#godiste").val() == "" ||
                        $("#tablice").val() == "") {
                        poruka = "Sva polja moraju biti popunjena i lokacija izabrana. ";
                    }
                    if (xx == null && yy == null) {
                        xx = login_user.Lokacija.XKordinata;
                        yy = login_user.Lokacija.YKordinata;
                        ulica_broj = login_user.Lokacija.Adresa.Ulica_broj;
                        grad = login_user.Lokacija.Adresa.Mesto;
                    }
                }
                else {
                    if ($("#username").val() == "" || $("#password").val() == "" || $("#name").val() == "" ||
                        $("#lastname").val() == "" || $("#jmbg").val() == "" || $("#tel").val() == "" ||
                        $("#email").val() == "") {
                        poruka = "Sva polja moraju biti popunjena. ";
                    }
                }
                if ($("#jmbg").val().length != 13) {
                    poruka += "JMBG mora imati 13 brojeva.";
                }

                $("#error1").html(poruka);

                if (poruka == "") {
                    if (login_user.Uloga == "2") {
                        var sand = {
                            Id: login_user.Id,
                            KorisnickoIme: $("#username").val(),
                            Lozinka: $("#password").val(),
                            Ime: $("#name").val(),
                            Prezime: $("#lastname").val(),
                            Pol: $("#pol").val(),
                            JMBG: $("#jmbg").val(),
                            Telefon: $("#tel").val(),
                            Email: $("#email").val(),
                            Uloga: "Vozac",
                            Lokacija:
                            {
                                XKordinata: xx,
                                YKordinata: yy,
                                Adresa:
                                {
                                    Ulica_broj: ulica_broj,
                                    Mesto: grad
                                }
                            },
                            Voznje: login_user.Voznje,
                            Automobil:
                            {
                                GodisteAutomobila: $("#godiste").val(),
                                RegistarskaTablica: $("#tablice").val(),
                                TipVozila: $("#cartipe").val()
                            }
                        };
                    }
                    else {
                        var sand = {
                            Id: login_user.Id,
                            KorisnickoIme: $("#username").val(),
                            Lozinka: $("#password").val(),
                            Ime: $("#name").val(),
                            Prezime: $("#lastname").val(),
                            Pol: $("#pol").val(),
                            JMBG: $("#jmbg").val(),
                            Telefon: $("#tel").val(),
                            Email: $("#email").val(),
                            Uloga: login_user.Uloga,
                            Voznje: login_user.Voznje
                        };
                    }

                    $.post("/api/main/updateprofile", sand, function (login_user, status) {
                        if (status == "success") {
                            var table = "";
                            if (login_user == "Korisničko ime već postoji u sistemu." || login_user == "Došlo je do greške. Probajte ponovo.") {
                                login_user = JSON.parse(localStorage.getItem("loginuser"));
                                table += "<div id=\"erorrr\">" + login_user + "</div><br /><p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";

                            } else {
                                table += "<div id=\"erorrr\">Uspešno ažuriran profil.</div><br /><p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                            }
                            table += "<input type=\"submit\" id=\"reset\" value=\"Reset tabele\" /><br /><br />";
                            table += "<table border=\"1\" id=\"maintable\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                            for (t in login_user.Voznje) {
                                table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                                if (login_user.Voznje[t].Odrediste != null)
                                    table += login_user.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + login_user.Voznje[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                                table += "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                                var date = login_user.Voznje[t].VremePorudjbine.split("T");
                                var time = date[1].split(".");
                                table += date[0] + " ~ " + time[0];

                                table += "</td><td>" + login_user.Voznje[t].Iznos + "</td><td>";
                                if (login_user.Voznje[t].Komentar != null)
                                    if (login_user.Voznje[t].Komentar.OcenaVoznje != null)
                                        table += login_user.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                                    else
                                        table += "0</td><td>";
                                else
                                    table += "0</td><td>";

                                if (login_user.Voznje[t].StatusVoznje == "1") {
                                    table += "Formirana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "2") {
                                    table += "Obrađena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "3") {
                                    table += "Prihvaćena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "4") {
                                    table += "Otkazana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "5") {
                                    table += "Neuspešna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "6") {
                                    table += "Uspešna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "0") {
                                    table += "Kreirana";
                                }

                                table += "</td><td><input type=\"submit\"";
                                if (login_user.Uloga == "1")
                                    if (login_user.Voznje[t].StatusVoznje != "0")
                                        table += " disabled ";
                                if (login_user.Uloga == "0")
                                    if (login_user.Voznje[t].StatusVoznje == "2" || login_user.Voznje[t].StatusVoznje == "3" || login_user.Voznje[t].StatusVoznje == "4" || login_user.Voznje[t].StatusVoznje == "5")
                                        table += " disabled ";
                                if (login_user.Uloga == "2")
                                    if (login_user.Voznje[t].StatusVoznje == "6" || login_user.Voznje[t].StatusVoznje == "5")
                                        table += " disabled ";
                                table += "name=\"obrada_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"";
                                if (login_user.Uloga == "2" && login_user.Voznje[t].StatusVoznje == "0")
                                    table += "Preuzmi";
                                else
                                    table += "Obrada vožnje";
                                table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                            }
                            table += "</table><br />";

                            if (login_user.Uloga == "1") {
                                table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                            } else if (login_user.Uloga == "2") {
                                table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                            }

                            table += pocetnastr;

                            if (login_user.Uloga == "1") {
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu vozača:<br />"
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                            }
                            else if (login_user.Uloga == "2") {
                                table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                            }

                            table += "</div>";

                            localStorage.removeItem("loginuser");
                            localStorage.setItem("loginuser", JSON.stringify(login_user));
                            localStorage.setItem("screen", table);
                            $("#screen").html(table);
                        }
                    });
                }

                            }
                        }
                    });
            });

            $(document).on("click", "#adddrive", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                localStorage.removeItem("sveVoznje");
                localStorage.removeItem("slobodneVoznje");
                localStorage.removeItem("pretraga");
                var addDrive = "<div><div id= \"error1\" class=\"Red\" ></div ><p style=\"font-weight:bold; font-size:x-large\">Dodaj vožnju<\p>";
                addDrive += "<p id=\"greskavoznja\" class=\"Red\"></p><br />Polazište:<br />";
                addDrive += "<p id=\"kord\"></p>";
                var mapa = "<div id=\"map\" style=\"height:400px; text-align: center; width:50%\" class=\"map\"></div><script>";
                mapa += "var xx; var yy; var ulica_broj; var grad;";
                mapa += "function reverseGeocode(coords) {";
                mapa += "fetch('http://nominatim.openstreetmap.org/reverse?format=json&lon=' + coords[0] + '&lat=' + coords[1])";
                mapa += ".then(function(response) {return response.json();}).then(function(json) {var add = json.address;console.log(add);";
                mapa += "ulica_broj = add.road; if(add.house_number != null){ulica_broj += \" \"+add.house_number;}grad = add.city + \" \" + add.postcode; $(\"#kord\").html(\"[\" + ulica_broj +\" , \"+ grad + \"]\");});}";
                mapa += "var map = new ol.Map({layers: [new ol.layer.Tile({";
                mapa += "source: new ol.source.OSM()})],target: 'map',view: new ol.View({";
                mapa += "center: [2209717.3810248757,5660306.884676355],zoom: 19})});";
                mapa += "map.on('dblclick', function (evt) {var coord = ol.proj.toLonLat(evt.coordinate); reverseGeocode(coord);";
                mapa += " xx = coord[0]; yy = coord[1];});";
                mapa += "<\/script>";
                addDrive += mapa;
                addDrive += "<br /><br />Tip automobila: &nbsp;&nbsp;";
                addDrive += "<select id=\"cartipe\"><option value=\"Putnicko_Vozilo\">Putničko vozilo</option><option value=\"Kombi_Vozilo\">Kombi vozilo</option></select><br /><br />";

                if (login_user.Uloga == "1") {
                    addDrive += "Izabrati vozača: &nbsp;&nbsp;";
                    addDrive += "<select id=\"vozaci\">";
                    addDrive += "</select><br /><br />";
                }
                addDrive += "<input type=\"submit\" id=\"add_drive_button\" value=\"Dodaj Vožnju\" /></div>";
                localStorage.setItem("screen", addDrive);
                $("#screen").html(addDrive);
            });

            $(document).on("click", "#dodrive", function () {
                $.get("/api/main/getblokirane", function (data,status)
                {
                    if (status == "success") {
                        localStorage.removeItem("sveVoznje");
                        localStorage.removeItem("slobodneVoznje");
                        localStorage.removeItem("pretraga");
                        var blok = "<div><div id= \"error1\" class=\"Red\" ></div > <p style=\"font-weight:bold; font-size:x-large\">Blokirani<\p>";
                        blok += "<table border=\"1\" id=\"maintable\"><tr><td>Korisnicko ime</td><td>Uloga</td><td>&nbsp;</td></tr>";
                        for (var k in data) {
                            blok += "<tr><td>" + data[k][1] + "</td><td>";
                            blok += data[k][2] + "</td>";
                            blok += "<td><input type=\"submit\" name=\"odblokiraj\" id=\"" + data[k][0] + "\" value=\"Odblokiraj\"></td></tr>";
                        }
                        blok += "</table><br/><br/><p style=\"font-weight:bold; font-size:large\">Blokirati unosom korisnickog imena<\p>";
                        blok += "<input type=\"text\" id=\"blokirajpoimenu\"> &nbsp;&nbsp;<input type=\"submit\" id=\"blokiraj\" value=\"Blokiraj\">";
                        localStorage.setItem("screen", blok);
                        $("#screen").html(blok);
                    }
                });
            });

            $(document).on("click", "#blokiraj", function ()
            {
                if ($("#blokirajpoimenu").val().trim() != "") {
                    
                    $.get("/api/main/blokiranje", { Username: $("#blokirajpoimenu").val() }, function (data, status)
                    {
                        if (status == "success")
                        {
                            var login_user = JSON.parse(localStorage.getItem("loginuser"));
                            if (data[0][1] != null) {
                                var blok = "<div><div id= \"error1\" class=\"Red\" ></div > <p style=\"font-weight:bold; font-size:x-large\">Blokirani<\p>";
                                blok += "<table border=\"1\" id=\"maintable\"><tr><td>Korisnicko ime</td><td>Uloga</td><td>&nbsp;</td></tr>";
                                for (var k in data) {
                                    blok += "<tr><td>" + data[k][1] + "</td><td>";
                                    blok += data[k][2] + "</td>";
                                    blok += "<td><input type=\"submit\" name=\"odblokiraj\" id=\""+data[k][0]+"\" value=\"Odblokiraj\"></td></tr>";
                                }
                                blok += "</table><br/><br/><p style=\"font-weight:bold; font-size:large\">Blokirati unosom korisnickog imena<\p>";
                                blok += "<input type=\"text\" id=\"blokirajpoimenu\"> &nbsp;&nbsp;<input type=\"submit\" id=\"blokiraj\" value=\"Blokiraj\">";
                                localStorage.setItem("screen", blok);
                                login_user.Blokiran = "true";
                                localStorage.setItem("loginuser", JSON.stringify(login_user));
                                $("#screen").html(blok);
                            } else {
                                $("#error1").html(data);
                            }
                        }
                    });
                }
                else {
                    $("#error1").html("Korisničko ime mora biti uneto kako bi se data osoba blokirala.");
                }
            });

            $(document).on("dblclick", "#map", function ()
            {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                if (login_user.Uloga == "1") {
                    var xcord = xx;
                    var ycord = yy;
                    if (xcord != null && ycord != null) {
                        var cords = {
                            x: xcord,
                            y: ycord,
                        };
                        $.get("/api/main/get5closest", cords).done(function (data, status) {
                            if (status == "success") {
                                var por = "";
                                if (data[0] != null) {
                                    for (var key in data) {
                                        por += "<option value=\"" + data[key][0] + "\">" + data[key][1] + "</option>";
                                    }
                                    $("#vozaci").html(por);
                                } else
                                {
                                    por = "Trenutno nema slobodnih vozača. Probajte kasnije.";
                                    $("#greskavoznja").html(por);
                                }
                            }
                        });
                    }
                }
            });

            $(document).on("click", "[name = 'odblokiraj']", function () {
                var id = $(this).attr("id");
                var json = { Id: id };

                $.get("/api/main/odblokiraj", json).done(function (data, status) {
                    if (status == "success") {
                        var login_user = JSON.parse(localStorage.getItem("loginuser"));
                        var blok = "<div><div id= \"error1\" class=\"Red\" ></div > <p style=\"font-weight:bold; font-size:x-large\">Blokirani<\p>";
                        blok += "<table border=\"1\" id=\"maintable\"><tr><td>Korisnicko ime</td><td>Uloga</td><td>&nbsp;</td></tr>";
                        for (var k in data) {
                            blok += "<tr><td>" + data[k][1] + "</td><td>";
                            blok += data[k][2] + "</td>";
                            blok += "<td><input type=\"submit\" name=\"odblokiraj\" id=\"" + data[k][0] + "\" value=\"Odblokiraj\"></td></tr>";
                        }
                        blok += "</table><br/><br/><p style=\"font-weight:bold; font-size:large\">Blokirati unosom korisnickog imena<\p>";
                        blok += "<input type=\"text\" id=\"blokirajpoimenu\"> &nbsp;&nbsp;<input type=\"submit\" id=\"blokiraj\" value=\"Blokiraj\">";
                        login_user.Blokiran = "false";
                        localStorage.setItem("loginuser", JSON.stringify(login_user));
                        localStorage.setItem("screen", blok);
                        $("#screen").html(blok);
                    }

                });
            });

            $(document).on("click", "[name = 'obrada_voznje']", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var id = $(this).attr("id");
                var voznja;

                for (var i in login_user.Voznje) {
                    if (login_user.Voznje[i].Id == id) {
                        voznja = login_user.Voznje[i];
                        break;
                    }
                }

                if (voznja == null && login_user.Uloga == "1")
                {
                    var voznje = JSON.parse(localStorage.getItem("sveVoznje"));
                    for (var i in voznje) {
                        if (voznje[i].Id == id) {
                            voznja = voznje[i];
                            break;
                        }
                    }
                }

                if (voznja == null && login_user.Uloga == "2")
                {
                    var voznje = JSON.parse(localStorage.getItem("slobodneVoznje"));
                    for (var i in voznje) {
                        if (voznje[i].Id == id) {
                            voznja = voznje[i];
                            break;
                        }
                    }
                }

                if (login_user.Uloga == "0") { //Musterija
                    if (voznja.StatusVoznje == "0") { //Kreirana
                        var prikaz = "<div style=\"color: red\" id=\"error\"></div><input type=\"hidden\" id=\"hiddenidvozaca\" name=\"" + login_user.Id + "\" ><input type=\"hidden\" id=\"hiddenid\" name=\"" + id + "\" > <p id=\"kord\">Polazna tačka: &nbsp;&nbsp;[" + voznja.PolaznaTacka.Adresa.Ulica_broj + "," + voznja.PolaznaTacka.Adresa.Mesto + "]</p>";
                        var mapa = "<div id=\"map\" style=\"height:200px; text-align: center; width:25%\" class=\"map\"></div><script>";
                        mapa += "var xx =\"" + voznja.PolaznaTacka.XKordinata + "\"; var yy =\"" + voznja.PolaznaTacka.YKordinata + "\"; var ulica_broj=\"" + voznja.PolaznaTacka.Adresa.Ulica_broj + "\"; var grad=\"" + voznja.PolaznaTacka.Adresa.Mesto + "\";";
                        mapa += "function reverseGeocode(coords) {";
                        mapa += "fetch('http://nominatim.openstreetmap.org/reverse?format=json&lon=' + coords[0] + '&lat=' + coords[1])";
                        mapa += ".then(function(response) {return response.json();}).then(function(json) {var add = json.address;console.log(add);";
                        mapa += "ulica_broj = add.road; if(add.house_number != null){ulica_broj += \" \"+add.house_number;}grad = add.city + \" \" + add.postcode; $(\"#kord\").html(\"Polazna tačka: &nbsp;&nbsp;[\" + ulica_broj +\" , \"+ grad + \"]\");});}";
                        mapa += "var map = new ol.Map({layers: [new ol.layer.Tile({";
                        mapa += "source: new ol.source.OSM()})],target: 'map',view: new ol.View({";
                        mapa += "center: [2209717.3810248757,5660306.884676355],zoom: 19})});";
                        mapa += "map.on('dblclick', function (evt) {var coord = ol.proj.toLonLat(evt.coordinate); reverseGeocode(coord);";
                        mapa += " xx = coord[0]; yy = coord[1];});";
                        mapa += "<\/script>";
                        prikaz += mapa;
                        prikaz += "<br /><br />Tip automobila: &nbsp;&nbsp;";
                        if (voznja.TipVozila == "0")
                            prikaz += "<select id=\"cartipe\"><option value=\"Putnicko_Vozilo\">Putničko vozilo</option><option value=\"Kombi_Vozilo\">Kombi vozilo</option></select><br /><br />";
                        else
                            prikaz += "<select id=\"cartipe\"><option value=\"Kombi_Vozilo\">Kombi vozilo</option><option value=\"Putnicko_Vozilo\">Putničko vozilo</option></select><br /><br />";
                        prikaz += "<div id=\"formakodvozaca\"><input type=\"submit\" id=\"otkazati_voznju\" value=\"Otkazati vožnju\"><br />";
                        prikaz += "</div><br /><input type=\"submit\" value=\"Izmeni\" id=\"izmenivozju\">";
                        localStorage.setItem("screen", prikaz);
                        $("#screen").html(prikaz);
                    } else if (voznja.StatusVoznje == "6") { //Uspesna
                        var forma = "<div style=\"color: red\" id=\"error\"></div><input type=\"hidden\" id=\"gogo\" name=\"go\" >";
                        forma += "<input type=\"hidden\" id=\"hiddenidvozaca\" name=\"" + login_user.Id + "\" ><input type=\"hidden\" id=\"hiddenid\" name=\"" + id + "\" >";
                        forma += "<br />Opis:<br /><textarea style=\"resize: horizontal\" rows=\"6\" cols=\"80\" id=\"opis\"></textarea><br />";
                        forma += "Ocena vožnje: <select id=\"ocenavoznje\"><option value=\"0\">0</option><option value=\"1\">1</option><option value=\"2\">2</option><option value=\"3\">3</option><option value=\"4\">4</option><option value=\"5\">5</option></select><br /><br /><input type=\"submit\" value=\"Izmeni\" id=\"izmenivozju\">";

                        localStorage.setItem("screen", forma);
                        $("#screen").html(forma);
                    }
                }
                else if (login_user.Uloga == "1"){ //Dispecer
                    if (voznja.StatusVoznje == "0") { //Kreirana
                        var cords = {
                            x: voznja.PolaznaTacka.XKordinata,
                            y: voznja.PolaznaTacka.YKordinata
                        };
                        $.get("/api/main/get5closest", cords).done(function (data, status) {
                            if (status == "success") {
                                var forma = "<div style=\"color: red\" id=\"error\"></div><p style=\"font-size:large; font-weight:bold\">Vožnja</p>";
                                forma += "<input type=\"hidden\" id=\"hiddenidvozaca\" name=\"" + login_user.Id + "\" ><input type=\"hidden\" id=\"hiddenid\" name=\"" + id + "\" >";
                                forma += "Polazna tačka: [" + voznja.PolaznaTacka.Adresa.Ulica_broj + ",&nbsp;" + voznja.PolaznaTacka.Adresa.Mesto + "]<br />";
                                var i = voznja.VremePorudjbine.split("T");
                                var j = i[1].split(".");
                                forma += "Datum kreiranja vožnje: [" + i[0] + "&nbsp;&nbsp;&nbsp;&nbsp;" + j[0] + "]";
                                forma += "<br />Dodelite vozača:&nbsp;&nbsp;";
                                if (data[0] != null) {
                                    forma += "<select id=\"kojivozac\">;"
                                    for (var key in data) {
                                        forma += "<option value=\"" + data[key][0] + "\">" + data[key][1] + "</option>";
                                    }
                                    forma += "</select>";
                                    forma += "<br /><br /><input type=\"submit\" id=\"izmenivoznjudispecer\" value=\"Izmeni\">";
                                } else
                                {
                                    forma += "<p>Nema slobodnih vozača. Probajte kasnije.</p>";
                                }
                                
                                localStorage.setItem("screen", forma);
                                $("#screen").html(forma);
                            }
                        });
                    }
                }
                else{ //Vozac
                    if (voznja.StatusVoznje == "0") { //Kreirana
                        var login_user = JSON.parse(localStorage.getItem("loginuser"));

                        let data = { Id: login_user.Id };
                        $.get("/api/main/isitblocked", data, function (data, status) {
                            if (status == "success") {
                                if (data == "true") {
                                    localStorage.removeItem("loginuser");
                                    $("#mainmanu").html(menu);
                                    localStorage.setItem("screen", textlog);
                                    localStorage.setItem("manu", $("#mainmanu").html());
                                    $("#screen").html(textlog);
                                    $("#error1").html("Blokirani ste.");
                                }
                                else {
                        var l = {
                            Id: login_user.Id,
                            IdVoznje: id
                        }

                        $.ajax({
                            url: "/api/main/preuzmivoznju",
                            type: "PUT",
                            data: l,
                            success: function (data) {
                                var table = "";
                                var login_user = data;
                                if (login_user == "No")
                                {
                                    table += "<pstyle=\"color:red\">Došlo je do greške. Refrešovati tabelu.</p>";
                                    login_user = JSON.parse(localStorage.getItem("loginuser"));
                                }
                                table += "<div id=\"erorrr\"></div><p style=\"font-size:large; font-weight:bold\">Lista vožnji</p><div>";
                                table += "<input type=\"submit\" id=\"reset\" value=\"Reset tabele\" /><br /><br />";
                                table += "<table border=\"1\" id=\"maintable\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                                for (t in login_user.Voznje) {
                                    table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                                    if (login_user.Voznje[t].Odrediste != null)
                                        table += login_user.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + login_user.Voznje[t].Odrediste.Adresa.Mesto;
                                    else
                                        table += "null";
                                    table += "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                                    var date = login_user.Voznje[t].VremePorudjbine.split("T");
                                    var time = date[1].split(".");
                                    table += date[0] + " ~ " + time[0];

                                    table += "</td><td>" + login_user.Voznje[t].Iznos + "</td><td>";
                                    if (login_user.Voznje[t].Komentar != null)
                                        if (login_user.Voznje[t].Komentar.OcenaVoznje != null)
                                            table += login_user.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                                        else
                                            table += "0</td><td>";
                                    else
                                        table += "0</td><td>";

                                    if (login_user.Voznje[t].StatusVoznje == "1") {
                                        table += "Formirana";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "2") {
                                        table += "Obrađena";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "3") {
                                        table += "Prihvaćena";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "4") {
                                        table += "Otkazana";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "5") {
                                        table += "Neuspešna";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "6") {
                                        table += "Uspešna";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "0") {
                                        table += "Kreirana";
                                    }

                                    table += "</td><td><input type=\"submit\"";
                                    if (login_user.Uloga == "1")
                                        if (login_user.Voznje[t].StatusVoznje != "0")
                                            table += " disabled ";
                                    if (login_user.Uloga == "0")
                                        if (login_user.Voznje[t].StatusVoznje == "2" || login_user.Voznje[t].StatusVoznje == "3" || login_user.Voznje[t].StatusVoznje == "4" || login_user.Voznje[t].StatusVoznje == "5")
                                            table += " disabled ";
                                    if (login_user.Uloga == "2")
                                        if (login_user.Voznje[t].StatusVoznje == "6" || login_user.Voznje[t].StatusVoznje == "5")
                                            table += " disabled ";
                                    table += "name=\"obrada_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"";
                                    if (login_user.Uloga == "2" && login_user.Voznje[t].StatusVoznje == "0")
                                        table += "Preuzmi";
                                    else
                                        table += "Obrada vožnje";
                                    table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                                }
                                table += "</table><br />";

                                if (login_user.Uloga == "1") {
                                    table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                                } else if (login_user.Uloga == "2") {
                                    table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                                }

                                table += pocetnastr;

                                if (login_user.Uloga == "1") {
                                    table += "<br />";
                                    table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                    table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                                    table += "<br />";
                                    table += "Pretraga po imenu i prezimenu vozača:<br />"
                                    table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                                }
                                else if (login_user.Uloga == "2") {
                                    table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                                }

                                table += "</div>";
                                localStorage.setItem("loginuser", JSON.stringify(login_user));
                                localStorage.setItem("screen", table);
                                $("#screen").html(table);
                            }
                        });
                                }
                            }
                        });
                    }
                    else {
                        var t = "<input type=\"hidden\" id=\"idvozaca\" name=\"" + login_user.Id + "\"><input type=\"hidden\" id=\"idvoznje\" name=\"" + id + "\"><p id=\"errror\"></p>Status:&nbsp;&nbsp; <select id=\"zavrsivoznju\"><option value=\"-1\"></option ><option value=\"5\">Neuspešna</option ><option value=\"6\">Uspešna</option ></select>";
                        t += "<div id=\"selectvoznju\"></div>";
                        t += "<br /><input type=\"submit\" id=\"zakljucivoznju\" value=\"Izmeni\">";
                        localStorage.setItem("screen", t);
                        $("#screen").html(t);
                    }
                }
                localStorage.removeItem("sveVoznje");
                localStorage.removeItem("slobodneVoznje");
                localStorage.removeItem("pretraga");
            });

            $(document).on("change", "#zavrsivoznju", function ()
            {
                var m = $("#zavrsivoznju").val();
                if (m == "5") //Neuspesna
                {
                    var tt = "<br />Opis:<br /><textarea style=\"resize: horizontal\" rows=\"6\" cols=\"80\" id=\"opis\"></textarea><br />";
                    $("#selectvoznju").html(tt);
                }
                else if (m == "6") //Uspesna
                {
                    var tt = "<br />Cena: &nbsp;&nbsp;<input type=\"text\" id=\"cenavoznje\">";
                    tt += "<p id=\"kord\">Lokacija:</p>";
                    var map = "<div id=\"map\" style=\"height:400px; text-align: center; width:50%\" class=\"map\"></div><script>";
                    map += "var xx; var yy; var ulica_broj; var grad;";
                    map += "function reverseGeocode(coords) {";
                    map += "fetch('http://nominatim.openstreetmap.org/reverse?format=json&lon=' + coords[0] + '&lat=' + coords[1])";
                    map += ".then(function(response) {return response.json();}).then(function(json) {var add = json.address;console.log(add);";
                    map += "ulica_broj = add.road; if(add.house_number != null){ulica_broj += \" \"+add.house_number;}grad = add.city + \" \" + add.postcode; $(\"#kord\").html(\"Lokacija: [\" + ulica_broj +\" , \"+ grad + \"]\");});}";
                    map += "var map = new ol.Map({layers: [new ol.layer.Tile({";
                    map += "source: new ol.source.OSM()})],target: 'map',view: new ol.View({";
                    map += "center: [2209717.3810248757,5660306.884676355],zoom: 19})});";
                    map += "map.on('dblclick', function (evt) {var coord = ol.proj.toLonLat(evt.coordinate); reverseGeocode(coord);";
                    map += " xx = coord[0]; yy = coord[1];});";
                    map += "<\/script>";
                    tt += map;
                    $("#selectvoznju").html(tt);
                }
            });

            $(document).on("click", "#zakljucivoznju", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));

                let data = { Id: login_user.Id };
                $.get("/api/main/isitblocked", data, function (data, status) {
                    if (status == "success") {
                        if (data == "true") {
                            localStorage.removeItem("loginuser");
                            $("#mainmanu").html(menu);
                            localStorage.setItem("screen", textlog);
                            localStorage.setItem("manu", $("#mainmanu").html());
                            $("#screen").html(textlog);
                            $("#error1").html("Blokirani ste.");
                        }
                        else {
                var l;
                if($("#opis").val() != null)
                {
                    if ($("#opis").val() == "")
                    {
                        $("#errror").html("Opis mora biti popunjen.").css("color", "red");
                        return;
                    }

                     l =
                        {
                            IdVoznje: $("#idvoznje").attr("name"),
                            IdVozaca: $("#idvozaca").attr("name"),
                            Opis: $("#opis").val(),
                        }

                }
                if ($("#cenavoznje").val() != null)
                    if ($("#cenavoznje").val() == "" || xx == null) {
                        $("#errror").html("Cena i lokacija moraju biti popunjene.").css("color", "red");
                        return;
                    } else
                    {
                        if (isNaN(parseInt($("#cenavoznje").val())))
                        {
                            $("#errror").html("Cena mora biti broj.").css("color", "red");
                            return;
                        }
                        l =
                            {
                                IdVoznje: $("#idvoznje").attr("name"),
                                IdVozaca: $("#idvozaca").attr("name"),
                                Opis: $("#opis").val(),
                                Cena: $("#cenavoznje").val(),
                                Destinacija:
                                {
                                    XKordinata: xx,
                                    YKordinata: yy,
                                    Adresa: {
                                        Ulica_broj: ulica_broj,
                                        Mesto: grad
                                    }
                                }
                            }
                    }

                $.ajax({
                    url: "/api/main/vozacizmenavoznje",
                    type: "PUT",
                    data: l,
                    success: function (login_user) {
                        var table = "";
                        if (login_user == "Došlo je do greške. Probajte ponovo.") {
                            table += "<p style=\"color:red\" id=\"erorrr\">Došlo je do greške. Refrešujte tabelu.</p>";
                            login_user = JSON.parse(localStorage.getItem("loginuser"));
                        } else
                        {
                            table += "<div id=\"erorrr\"></div>";
                        }
                        table += "<p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                        table += "<input type=\"submit\" id=\"reset\" value=\"Reset tabele\" /><br /><br />";
                        table += "<table border=\"1\" id=\"maintable\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in login_user.Voznje) {
                            table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (login_user.Voznje[t].Odrediste != null)
                                table += login_user.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + login_user.Voznje[t].Odrediste.Adresa.Mesto;
                            else
                                table += "null";
                            table += "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                            var date = login_user.Voznje[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + login_user.Voznje[t].Iznos + "</td><td>";
                            if (login_user.Voznje[t].Komentar != null)
                                if (login_user.Voznje[t].Komentar.OcenaVoznje != null)
                                    table += login_user.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (login_user.Voznje[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (login_user.Uloga == "1")
                                if (login_user.Voznje[t].StatusVoznje != "0")
                                    table += " disabled ";
                            if (login_user.Uloga == "0")
                                if (login_user.Voznje[t].StatusVoznje == "2" || login_user.Voznje[t].StatusVoznje == "3" || login_user.Voznje[t].StatusVoznje == "4" || login_user.Voznje[t].StatusVoznje == "5")
                                    table += " disabled ";
                            if (login_user.Uloga == "2")
                                if (login_user.Voznje[t].StatusVoznje == "6" || login_user.Voznje[t].StatusVoznje == "5")
                                    table += " disabled ";
                            table += "name=\"obrada_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"";
                            if (login_user.Uloga == "2" && login_user.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        table += "</table><br />";

                        if (login_user.Uloga == "1") {
                            table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                        } else if (login_user.Uloga == "2") {
                            table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                        }

                        table += pocetnastr;

                        if (login_user.Uloga == "1") {
                            table += "<br />";
                            table += "Pretraga po imenu i prezimenu mušterije:<br />";
                            table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                            table += "<br />";
                            table += "Pretraga po imenu i prezimenu vozača:<br />"
                            table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                        }
                        else if (login_user.Uloga == "2") {
                            table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                        }

                        table += "</div>";
                        localStorage.setItem("loginuser", JSON.stringify(login_user));
                        localStorage.setItem("screen", table);
                        $("#screen").html(table);
                    }
                });
                        }
                    }
                });
            });

            $(document).on("click", "#otkaziotkazivanje", function () {
                $("#formakodvozaca").html("<input type=\"submit\" id=\"otkazati_voznju\" value=\"Otkazati vožnju\">");
            });

            $(document).on("click", "#otkazati_voznju", function () {
                var forma = "<input type=\"submit\" value=\"Odustati od otkazivanja\" id=\"otkaziotkazivanje\"><br />Opis:<br /><textarea style=\"resize: horizontal\" rows=\"6\" cols=\"80\" id=\"opis\"></textarea><br />";
                forma += "Ocena vožnje: <select id=\"ocenavoznje\"><option value=\"0\">0</option><option value=\"1\">1</option><option value=\"2\">2</option><option value=\"3\">3</option><option value=\"4\">4</option><option value=\"5\">5</option></select>";

                $("#formakodvozaca").html(forma);
            });

            $(document).on("click", "#izmenivozju", function ()
            {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));

                let data = { Id: login_user.Id };
                $.get("/api/main/isitblocked", data, function (data, status) {
                    if (status == "success") {
                        if (data == "true") {
                            localStorage.removeItem("loginuser");
                            $("#mainmanu").html(menu);
                            localStorage.setItem("screen", textlog);
                            localStorage.setItem("manu", $("#mainmanu").html());
                            $("#screen").html(textlog);
                            $("#error1").html("Blokirani ste.");
                        }
                        else {
                var l;
                if ($("#gogo").attr("name") == "go") {
                        l = {
                            Id: $("#hiddenidvozaca").attr("name"),
                            IdVoznje: $("#hiddenid").attr("name"),
                            Opis: $("#opis").val(),
                            Ocena: $("#ocenavoznje").val()
                        }
                }
                else if ($("#opis").val() != null) {
                    if ($("#opis").val().trim() == "") {
                        $("#error").html("Opis mora biti popunjen.");
                        return;
                    } else {
                           l = {
                                Id: $("#hiddenidvozaca").attr("name"),
                                IdVoznje: $("#hiddenid").attr("name"),
                                Lokacija:
                                {
                                    XKordinata: xx,
                                    YKordinata: yy,
                                    Adresa:
                                    {
                                        Ulica_broj: ulica_broj,
                                        Mesto: grad
                                    }
                                },
                                TipVozila: $("#cartipe").val(),
                                Opis: $("#opis").val(),
                                Ocena: $("#ocenavoznje").val()
                        }
                    }
                } else {
                    l = {
                        Id: $("#hiddenidvozaca").attr("name"),
                        IdVoznje: $("#hiddenid").attr("name"),
                        Lokacija:
                        {
                            XKordinata: xx,
                            YKordinata: yy,
                            Adresa:
                            {
                                Ulica_broj: ulica_broj,
                                Mesto: grad
                            }
                        },
                        TipVozila: $("#cartipe").val()
                    };
                }

                    $.ajax({
                        url: "/api/main/musterijaizmenavoznje",
                        type: "PUT",
                        data: l,
                        success: function (data) {
                            var login_user = data;
                            var table = "";
                            if (login_user == "Došlo je do greške. Probajte ponovo.") {
                                table += "<p style=\"color:red\">Došlo je do greške. Refrešujte tabelu.</p>";
                                login_user = JSON.parse(localStorage.getItem("loginuser"));
                            }
                            if (login_user == "No")
                            {
                                table += "<p style=\"color:red\">Došlo je do greške. Refrešujte tabelu.</p>";
                                login_user = JSON.parse(localStorage.getItem("loginuser"));
                            }
                            table += "<div id=\"erorrr\"></div><p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                            table += "<input type=\"submit\" id=\"reset\" value=\"Reset tabele\" /><br /><br />";
                            table += "<table border=\"1\" id=\"maintable\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                            for (t in login_user.Voznje) {
                                table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                                if (login_user.Voznje[t].Odrediste != null)
                                    table += login_user.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + login_user.Voznje[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                                table += "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                                var date = login_user.Voznje[t].VremePorudjbine.split("T");
                                var time = date[1].split(".");
                                table += date[0] + " ~ " + time[0];

                                table += "</td><td>" + login_user.Voznje[t].Iznos + "</td><td>";
                                if (login_user.Voznje[t].Komentar != null)
                                    if (login_user.Voznje[t].Komentar.OcenaVoznje != null)
                                        table += login_user.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                                    else
                                        table += "0</td><td>";
                                else
                                    table += "0</td><td>";

                                if (login_user.Voznje[t].StatusVoznje == "1") {
                                    table += "Formirana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "2") {
                                    table += "Obrađena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "3") {
                                    table += "Prihvaćena";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "4") {
                                    table += "Otkazana";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "5") {
                                    table += "Neuspešna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "6") {
                                    table += "Uspešna";
                                }
                                else if (login_user.Voznje[t].StatusVoznje == "0") {
                                    table += "Kreirana";
                                }

                                table += "</td><td><input type=\"submit\"";
                                if (login_user.Uloga == "1")
                                    if (login_user.Voznje[t].StatusVoznje != "0")
                                        table += " disabled ";
                                if (login_user.Uloga == "0")
                                    if (login_user.Voznje[t].StatusVoznje == "2" || login_user.Voznje[t].StatusVoznje == "3" || login_user.Voznje[t].StatusVoznje == "4" || login_user.Voznje[t].StatusVoznje == "5")
                                        table += " disabled ";
                                if (login_user.Uloga == "2")
                                    if (login_user.Voznje[t].StatusVoznje == "6" || login_user.Voznje[t].StatusVoznje == "5")
                                        table += " disabled ";
                                table += "name=\"obrada_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"";
                                if (login_user.Uloga == "2" && login_user.Voznje[t].StatusVoznje == "0")
                                    table += "Preuzmi";
                                else
                                    table += "Obrada vožnje";
                                table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                            }
                            table += "</table><br />";

                            if (login_user.Uloga == "1") {
                                table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                            } else if (login_user.Uloga == "2") {
                                table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                            }

                            table += pocetnastr;

                            if (login_user.Uloga == "1") {
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                                table += "<br />";
                                table += "Pretraga po imenu i prezimenu vozača:<br />"
                                table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                            }
                            else if (login_user.Uloga == "2") {
                                table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                            }

                            table += "</div>";
                            localStorage.setItem("loginuser", JSON.stringify(login_user));
                            localStorage.setItem("screen", table);
                            $("#screen").html(table);
                        }
                });

                        }
                    }
                });
            });

            $(document).on("click","[name = 'detalji_voznje']",function() {
                var idVoznje = $(this).attr("id");
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                localStorage.removeItem("sveVoznje");
                localStorage.removeItem("slobodneVoznje");
                localStorage.removeItem("pretraga");
                var data = { IdVoznje: idVoznje, IdVozaca: login_user.Id }
                $.get("/api/main/detaljivoznje", data, function (data, status)
                {
                    if (status == "success")
                    {
                        localStorage.setItem("screen", data);
                        $("#screen").html(data);
                    }
                });
            });

            $(document).on("click", "#add_drive_button", function ()
            {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                let data = { Id: login_user.Id };
                $.get("/api/main/isitblocked", data, function (data, status) {
                    if (status == "success") {
                        if (data == "true") {
                            localStorage.removeItem("loginuser");
                            $("#mainmanu").html(menu);
                            localStorage.setItem("screen", textlog);
                            localStorage.setItem("manu", $("#mainmanu").html());
                            $("#screen").html(textlog);
                            $("#error1").html("Blokirani ste.");
                        }
                        else {
                if (login_user.Uloga == "1") {
                    if ($("#vozaci").val() == null) {
                        $("#greskavoznja").html("Nema slobodnih vozača.");
                        return;
                    }
                }
                if (xx == null || yy == null) {
                    $("#greskavoznja").html("Sva polja moraju biti popunjena.");
                }
                else {
                    if (login_user.Uloga == "1") {
                        var message =
                            {
                                PolaznaTacka:
                                {
                                    XKordinata: xx,
                                    YKordinata: yy,
                                    Adresa:
                                    {
                                        Ulica_broj: ulica_broj,
                                        Mesto: grad
                                    }
                                },
                                TipVozila: $("#cartipe").val(),
                                Dispecer: login_user.Id,
                                Vozac: $("#vozaci").val()

                            };
                    } else {
                        var message =
                            {
                                PolaznaTacka:
                                {
                                    XKordinata: xx,
                                    YKordinata: yy,
                                    Adresa:
                                    {
                                        Ulica_broj: ulica_broj,
                                        Mesto: grad
                                    }
                                },
                                TipVozila: $("#cartipe").val(),
                                Musterija: login_user.Id
                            };
                    }

                    $.post("/api/main/adddriveto", message, function (data, status){
                        if (status == "success") {
                            if (data.KorisnickoIme == null)
                                $("#greskavoznja").html(data);
                            else {
                                login_user = data;
                                localStorage.removeItem("loginuser");
                                localStorage.setItem("loginuser", JSON.stringify(login_user));

                                var table = "<div id=\"erorrr\"></div><p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                                table += "<input type=\"submit\" id=\"reset\" value=\"Reset tabele\" /><br /><br />";
                                table += "<table border=\"1\" id=\"maintable\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                                for (t in login_user.Voznje) {
                                    table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                                    if (login_user.Voznje[t].Odrediste != null)
                                        table += login_user.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + login_user.Voznje[t].Odrediste.Adresa.Mesto;
                                    else
                                        table += "null";
                                    table += "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                                    var date = login_user.Voznje[t].VremePorudjbine.split("T");
                                    var time = date[1].split(".");
                                    table += date[0] + " ~ " + time[0];

                                    table += "</td><td>" + login_user.Voznje[t].Iznos + "</td><td>";
                                    if (login_user.Voznje[t].Komentar != null)
                                        if (login_user.Voznje[t].Komentar.OcenaVoznje != null)
                                            table += login_user.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                                        else
                                            table += "0</td><td>";
                                    else
                                        table += "0</td><td>";

                                    if (login_user.Voznje[t].StatusVoznje == "1") {
                                        table += "Formirana";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "2") {
                                        table += "Obrađena";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "3") {
                                        table += "Prihvaćena";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "4") {
                                        table += "Otkazana";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "5") {
                                        table += "Neuspešna";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "6") {
                                        table += "Uspešna";
                                    }
                                    else if (login_user.Voznje[t].StatusVoznje == "0") {
                                        table += "Kreirana";
                                    }

                                    table += "</td><td><input type=\"submit\"";
                                    if (login_user.Uloga == "1")
                                        if (login_user.Voznje[t].StatusVoznje != "0")
                                            table += " disabled ";
                                    if (login_user.Uloga == "0")
                                        if (login_user.Voznje[t].StatusVoznje == "2" || login_user.Voznje[t].StatusVoznje == "3" || login_user.Voznje[t].StatusVoznje == "4" || login_user.Voznje[t].StatusVoznje == "5")
                                            table += " disabled ";
                                    if (login_user.Uloga == "2")
                                        if (login_user.Voznje[t].StatusVoznje == "6" || login_user.Voznje[t].StatusVoznje == "5")
                                            table += " disabled ";
                                    table += "name=\"obrada_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"";
                                    if (login_user.Uloga == "2" && login_user.Voznje[t].StatusVoznje == "0")
                                        table += "Preuzmi";
                                    else
                                        table += "Obrada vožnje";
                                    table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                                }
                                table += "</table><br />";

                                if (login_user.Uloga == "1") {
                                    table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                                } else if (login_user.Uloga == "2") {
                                    table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                                }

                                table += pocetnastr;

                                if (login_user.Uloga == "1") {
                                    table += "<br />";
                                    table += "Pretraga po imenu i prezimenu mušterije:<br />";
                                    table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                                    table += "<br />";
                                    table += "Pretraga po imenu i prezimenu vozača:<br />"
                                    table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                                }
                                else if (login_user.Uloga == "2") {
                                    table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                                }

                                table += "</div>";
                                localStorage.setItem("loginuser", JSON.stringify(data));
                                localStorage.setItem("screen", table);
                                $("#screen").html(table);
                            }
                        }
                    });

                }
                        }
                    }
                });
            });

            $(document).on("click", "#izmenivoznjudispecer", function ()
            {
                var idDispecera = $("#hiddenidvozaca").attr("name");
                var idVoznje = $("#hiddenid").attr("name");
                var vozac = $("#kojivozac").val();
                var to =
                    {
                        IdDispecera: idDispecera,
                        IdVoznje: idVoznje,
                        IdVozaca: vozac
                    }

                $.ajax({
                    url: "/api/main/dispecerizmenavoznje",
                    type: "PUT",
                    data: to,
                    success: function (data) {
                        var login_user = data;
                        var table = "";
                        if (login_user == "Došlo je do greške. Probajte ponovo.") {
                            table += "<div style=\"color:red\" id=\"erorrr\">Došlo je do greške. Refrešujte tabelu.</div><br />";
                            login_user = JSON.parse(localStorage.getItem("loginuser"));
                        }

                        if (login_user == "No") {
                            table += "<div id=\"erorrr\">Došlo je do greške. Refrešujte tabelu.</div><br />";
                            login_user = JSON.parse(localStorage.getItem("loginuser"));
                        }
                        else
                        {
                            table += "<div id=\"erorrr\"></div><br />";
                        }
                        table += "<div id=\"erorrr\"></div><p style=\"font-size:large; font-weight:bold\">Lista vožnji<p><div>";
                        table += "<input type=\"submit\" id=\"reset\" value=\"Reset tabele\" /><br /><br />";
                        table += "<table border=\"1\" id=\"maintable\"><tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in login_user.Voznje) {
                            table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (login_user.Voznje[t].Odrediste != null)
                                table += login_user.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + login_user.Voznje[t].Odrediste.Adresa.Mesto;
                            else
                                table += "null";
                            table += "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                            var date = login_user.Voznje[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + login_user.Voznje[t].Iznos + "</td><td>";
                            if (login_user.Voznje[t].Komentar != null)
                                if (login_user.Voznje[t].Komentar.OcenaVoznje != null)
                                    table += login_user.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (login_user.Voznje[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (login_user.Uloga == "1")
                                if (login_user.Voznje[t].StatusVoznje != "0")
                                    table += " disabled ";
                            if (login_user.Uloga == "0")
                                if (login_user.Voznje[t].StatusVoznje == "2" || login_user.Voznje[t].StatusVoznje == "3" || login_user.Voznje[t].StatusVoznje == "4" || login_user.Voznje[t].StatusVoznje == "5")
                                    table += " disabled ";
                            if (login_user.Uloga == "2")
                                if (login_user.Voznje[t].StatusVoznje == "6" || login_user.Voznje[t].StatusVoznje == "5")
                                    table += " disabled ";
                            table += "name=\"obrada_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"";
                            if (login_user.Uloga == "2" && login_user.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        table += "</table><br />";

                        if (login_user.Uloga == "1") {
                            table += "<input type=\"submit\" id=\"sve_voznje_sis\" value=\"Sve vožnje u sistemu\" /><br /><br />";
                        } else if (login_user.Uloga == "2") {
                            table += "<input type=\"submit\" id=\"sve_voznje_cekanje\" value=\"Sve vožnje na čekanju\" /><br /><br />";
                        }

                        table += pocetnastr;

                        if (login_user.Uloga == "1") {
                            table += "<br />";
                            table += "Pretraga po imenu i prezimenu mušterije:<br />";
                            table += "Ime:&nbsp; <input type=\"text\" id=\"imemus\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimemus\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_mus\" value=\"Pretrazi\" /><br />";
                            table += "<br />";
                            table += "Pretraga po imenu i prezimenu vozača:<br />"
                            table += "Ime:&nbsp; <input type=\"text\" id=\"imevoz\">&nbsp; Prezime:&nbsp;<input type=\"text\" id=\"prezimevoz\">&nbsp;&nbsp;<input type=\"submit\" id=\"po_voz\" value=\"Pretrazi\" /><br />";
                        }
                        else if (login_user.Uloga == "2") {
                            table += "<br /><input type=\"submit\" id=\"sortiraj_udaljenost\" value=\"Sortiraj po udaljenosti\" /><br /><br />";
                        }

                        table += "</div>";
                        localStorage.setItem("loginuser", JSON.stringify(login_user));
                        localStorage.setItem("screen", table);
                        $("#screen").html(table);
                    }
                });
            });

            $(document).on("click", "#reset", function ()
            {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                localStorage.removeItem("sveVoznje");
                localStorage.removeItem("slobodneVoznje");
                localStorage.removeItem("pretraga");
                    let data = { Id: login_user.Id };
                    $.get("/api/main/isitblocked", data, function (data, status) {
                        if (status == "success") {
                            if (data == "true") {
                                localStorage.removeItem("loginuser");
                                $("#mainmanu").html(menu);
                                localStorage.setItem("screen", textlog);
                                localStorage.setItem("manu", $("#mainmanu").html());
                                $("#screen").html(textlog);
                                $("#error1").html("Blokirani ste.");
                            } else
                            {
                var id = { Id: login_user.Id }

                $.get("/api/main/resetbutton", id, function (login_user, status)
                {
                    if (status == "success")
                    {
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in login_user.Voznje) {
                            table += "<tr><td>" + login_user.Voznje[t].PolaznaTacka.Adresa.Ulica_broj + ", " + login_user.Voznje[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (login_user.Voznje[t].Odrediste != null)
                                table += login_user.Voznje[t].Odrediste.Adresa.Ulica_broj + ", " + login_user.Voznje[t].Odrediste.Adresa.Mesto;
                            else
                                table += "null";
                            table += "</td><td>" + login_user.Voznje[t].Musterija + "</td><td>" + login_user.Voznje[t].Vozac + "</td><td>" + login_user.Voznje[t].Dispecer + "</td><td>";

                            var date = login_user.Voznje[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + login_user.Voznje[t].Iznos + "</td><td>";
                            if (login_user.Voznje[t].Komentar != null)
                                if (login_user.Voznje[t].Komentar.OcenaVoznje != null)
                                    table += login_user.Voznje[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (login_user.Voznje[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (login_user.Voznje[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (login_user.Uloga == "1")
                                if (login_user.Voznje[t].StatusVoznje != "0")
                                    table += " disabled ";
                            if (login_user.Uloga == "0")
                                if (login_user.Voznje[t].StatusVoznje == "2" || login_user.Voznje[t].StatusVoznje == "3" || login_user.Voznje[t].StatusVoznje == "4" || login_user.Voznje[t].StatusVoznje == "5")
                                    table += " disabled ";
                            if (login_user.Uloga == "2")
                                if (login_user.Voznje[t].StatusVoznje == "6" || login_user.Voznje[t].StatusVoznje == "5")
                                    table += " disabled ";
                            table += "name=\"obrada_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"";
                            if (login_user.Uloga == "2" && login_user.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + login_user.Voznje[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }

                        localStorage.setItem("loginuser", JSON.stringify(login_user));
                        $("#maintable").html(table);
                    }
                });
                            }
                        }
                    });
            });

            $(document).on("click", "#sve_voznje_sis", function ()
            {
                $.get("/api/main/svevoznjeusistemu", function (data, status)
                {
                    if (status == "success") {
                        localStorage.removeItem("sveVoznje");
                        localStorage.removeItem("slobodneVoznje");
                        localStorage.removeItem("pretraga");
                            var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                            for (t in data) {
                                table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                                if (data[t].Odrediste != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                                table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                                var date = data[t].VremePorudjbine.split("T");
                                var time = date[1].split(".");
                                table += date[0] + " ~ " + time[0];

                                table += "</td><td>" + data[t].Iznos + "</td><td>";
                                if (data[t].Komentar != null)
                                    if (data[t].Komentar.OcenaVoznje != null)
                                        table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                    else
                                        table += "0</td><td>";
                                else
                                    table += "0</td><td>";

                                if (data[t].StatusVoznje == "1") {
                                    table += "Formirana";
                                }
                                else if (data[t].StatusVoznje == "2") {
                                    table += "Obrađena";
                                }
                                else if (data[t].StatusVoznje == "3") {
                                    table += "Prihvaćena";
                                }
                                else if (data[t].StatusVoznje == "4") {
                                    table += "Otkazana";
                                }
                                else if (data[t].StatusVoznje == "5") {
                                    table += "Neuspešna";
                                }
                                else if (data[t].StatusVoznje == "6") {
                                    table += "Uspešna";
                                }
                                else if (data[t].StatusVoznje == "0") {
                                    table += "Kreirana";
                                }

                                table += "</td><td><input type=\"submit\"";
                                if (data[t].StatusVoznje != "0")
                                    table += " disabled ";

                                table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                                table += "Obrada vožnje";
                                table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                            }
                            $("#maintable").html(table);
                            localStorage.setItem("sveVoznje", JSON.stringify(data));
                            localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });

            $(document).on("click", "#sve_voznje_cekanje", function ()
            {
                if (localStorage.getItem("slobodneVoznje") != null) { return; }
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var data = { Id: login_user.Id };
                $.get("/api/main/slobodnevoznjeusistemu",data, function (data, status) {
                    if (status == "success") {
                        if (data == "true") {
                            localStorage.removeItem("loginuser");
                            $("#mainmanu").html(menu);
                            localStorage.setItem("screen", textlog);
                            localStorage.setItem("manu", $("#mainmanu").html());
                            $("#screen").html(textlog);
                            $("#error1").html("Blokirani ste.");
                        } else {
                            var table = "";
                            for (t in data) {
                                table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                                if (data[t].Odrediste != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                                table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                                var date = data[t].VremePorudjbine.split("T");
                                var time = date[1].split(".");
                                table += date[0] + " ~ " + time[0];

                                table += "</td><td>" + data[t].Iznos + "</td><td>";
                                if (data[t].Komentar != null)
                                    if (data[t].Komentar.OcenaVoznje != null)
                                        table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                    else
                                        table += "0</td><td>";
                                else
                                    table += "0</td><td>";

                                if (data[t].StatusVoznje == "1") {
                                    table += "Formirana";
                                }
                                else if (data[t].StatusVoznje == "2") {
                                    table += "Obrađena";
                                }
                                else if (data[t].StatusVoznje == "3") {
                                    table += "Prihvaćena";
                                }
                                else if (data[t].StatusVoznje == "4") {
                                    table += "Otkazana";
                                }
                                else if (data[t].StatusVoznje == "5") {
                                    table += "Neuspešna";
                                }
                                else if (data[t].StatusVoznje == "6") {
                                    table += "Uspešna";
                                }
                                else if (data[t].StatusVoznje == "0") {
                                    table += "Kreirana";
                                }

                                table += "</td><td><input type=\"submit\"";
                                if (data[t].StatusVoznje != "0")
                                    table += " disabled ";

                                table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                                table += "Preuzmi";
                                table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                            }
                            $("#maintable").append(table);
                            localStorage.setItem("slobodneVoznje", JSON.stringify(data));
                            localStorage.setItem("screen", $("#screen").html());
                        }
                    }
                });
            });

            $(document).on("click", "#po_statusu", function ()
            {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var status = $("#status_v").val();
                var t = false;
                if (localStorage.getItem("sveVoznje") != null || localStorage.getItem("slobodneVoznje") != null)
                {
                    t = true;
                }
                var data =
                    {
                        IdKorisnika: login_user.Id,
                        Status: status,
                        Dodatni: t,
                        Pretraga: JSON.parse(localStorage.getItem("pretraga"))
                    }
                $.post("/api/main/postatusu", data, function (data, status)
                {
                    if (status == "success")
                    {
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in data) {
                            table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (data[t].Odrediste != null) {
                                if (data[t].Odrediste.Adresa != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                            } else
                                table += "null";
                            table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                            var date = data[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + data[t].Iznos + "</td><td>";
                            if (data[t].Komentar != null)
                                if (data[t].Komentar.OcenaVoznje != null)
                                    table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (data[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (data[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (data[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (data[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (data[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (data[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (data[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (data[t].StatusVoznje != "0")
                                table += " disabled ";

                            table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                            if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        $("#maintable").html(table);
                        localStorage.setItem("pretraga", JSON.stringify(data));
                        localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });

            $(document).on("click", "#po_datumu", function ()
            {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var t = false;
                if (localStorage.getItem("sveVoznje") != null || localStorage.getItem("slobodneVoznje") != null) {
                    t = true;
                }
                var data =
                    {
                        IdKorisnika: login_user.Id,
                        Dodatni: t,
                        Pretraga: JSON.parse(localStorage.getItem("pretraga"))
                    }
                $.post("/api/main/podatumu", data, function (data, status) {
                    if (status == "success") {
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in data) {
                            table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (data[t].Odrediste != null) {
                                if (data[t].Odrediste.Adresa != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                            } else
                                table += "null";
                            table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                            var date = data[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + data[t].Iznos + "</td><td>";
                            if (data[t].Komentar != null)
                                if (data[t].Komentar.OcenaVoznje != null)
                                    table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (data[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (data[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (data[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (data[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (data[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (data[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (data[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (data[t].StatusVoznje != "0")
                                table += " disabled ";

                            table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                            if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        $("#maintable").html(table);
                        localStorage.setItem("pretraga", JSON.stringify(data));
                        localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });

            $(document).on("click", "#po_oceni", function ()
            {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var t = false;
                if (localStorage.getItem("sveVoznje") != null || localStorage.getItem("slobodneVoznje") != null) {
                    t = true;
                }
                var data =
                    {
                        IdKorisnika: login_user.Id,
                        Dodatni: t,
                        Pretraga: JSON.parse(localStorage.getItem("pretraga"))
                    }
                $.post("/api/main/pooceni", data, function (data, status) {
                    if (status == "success") {
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in data) {
                            table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (data[t].Odrediste != null) {
                                if (data[t].Odrediste.Adresa != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                            } else
                                table += "null";
                            table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                            var date = data[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + data[t].Iznos + "</td><td>";
                            if (data[t].Komentar != null)
                                if (data[t].Komentar.OcenaVoznje != null)
                                    table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (data[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (data[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (data[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (data[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (data[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (data[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (data[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (data[t].StatusVoznje != "0")
                                table += " disabled ";

                            table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                            if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        $("#maintable").html(table);
                        localStorage.setItem("pretraga", JSON.stringify(data));
                        localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });

            $(document).on("click", "#sortiraj_udaljenost", function ()
            {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var t = false;
                if (localStorage.getItem("sveVoznje") != null || localStorage.getItem("slobodneVoznje") != null) {
                    t = true;
                }
                var data =
                    {
                        IdKorisnika: login_user.Id,
                        Dodatni: t,
                        Pretraga: JSON.parse(localStorage.getItem("pretraga"))
                    }
                $.post("/api/main/poudaljenosti", data, function (data, status) {
                    if (status == "success") {
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in data) {
                            table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (data[t].Odrediste != null) {
                                if (data[t].Odrediste.Adresa != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                            } else
                                table += "null";
                            table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                            var date = data[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + data[t].Iznos + "</td><td>";
                            if (data[t].Komentar != null)
                                if (data[t].Komentar.OcenaVoznje != null)
                                    table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (data[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (data[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (data[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (data[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (data[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (data[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (data[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (data[t].StatusVoznje != "0")
                                table += " disabled ";

                            table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                            if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        $("#maintable").html(table);
                        localStorage.setItem("pretraga", JSON.stringify(data));
                        localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });

            $(document).on("click", "#po_mus", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var t = false;
                if (localStorage.getItem("sveVoznje") != null || localStorage.getItem("slobodneVoznje") != null) {
                    t = true;
                }
                if ($("#imemus").val().trim() == "" && $("#prezimemus").val().trim() == "") {
                    $("#erorrr").html("Pretraga po mušteriji: makar jedna vrednost mora biti unesena.").css("color", "red");
                    return;
                }
                var data =
                    {
                        IdKorisnika: login_user.Id,
                        Dodatni: t,
                        Pretraga: JSON.parse(localStorage.getItem("pretraga")),
                        Stavka1: $("#imemus").val(),
                        Stavka2: $("#prezimemus").val()
                    }
                $.post("/api/main/poimenuprzmusterije", data, function (data, status) {
                    if (status == "success") {
                        $("#erorrr").html("");
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in data) {
                            table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (data[t].Odrediste != null) {
                                if (data[t].Odrediste.Adresa != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                            } else
                                table += "null";
                            table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                            var date = data[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + data[t].Iznos + "</td><td>";
                            if (data[t].Komentar != null)
                                if (data[t].Komentar.OcenaVoznje != null)
                                    table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (data[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (data[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (data[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (data[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (data[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (data[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (data[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (data[t].StatusVoznje != "0")
                                table += " disabled ";

                            table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                            if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        $("#maintable").html(table);
                        localStorage.setItem("pretraga", JSON.stringify(data));
                        localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });

            $(document).on("click", "#po_voz", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var t = false;
                if (localStorage.getItem("sveVoznje") != null || localStorage.getItem("slobodneVoznje") != null) {
                    t = true;
                }
                if ($("#imevoz").val().trim() == "" && $("#prezimevoz").val().trim() == "")
                {
                    $("#erorrr").html("Pretraga po vozaču: makar jedna vrednost mora biti unesena.").css("color", "red");
                    return;
                }
                var data =
                    {
                        IdKorisnika: login_user.Id,
                        Dodatni: t,
                        Pretraga: JSON.parse(localStorage.getItem("pretraga")),
                        Stavka1: $("#imevoz").val(),
                        Stavka2: $("#prezimevoz").val()
                    }
                $.post("/api/main/poimenuprzvozac", data, function (data, status) {
                    if (status == "success") {
                        $("#erorrr").html("");
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in data) {
                            table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (data[t].Odrediste != null) {
                                if (data[t].Odrediste.Adresa != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                            } else
                                table += "null";
                            table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                            var date = data[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + data[t].Iznos + "</td><td>";
                            if (data[t].Komentar != null)
                                if (data[t].Komentar.OcenaVoznje != null)
                                    table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (data[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (data[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (data[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (data[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (data[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (data[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (data[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (data[t].StatusVoznje != "0")
                                table += " disabled ";

                            table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                            if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        $("#maintable").html(table);
                        localStorage.setItem("pretraga", JSON.stringify(data));
                        localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });

            $(document).on("click", "#po_datumu_oddo", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var t = false;
                if (localStorage.getItem("sveVoznje") != null || localStorage.getItem("slobodneVoznje") != null) {
                    t = true;
                }
                if ($("#oddatum").val() == "" && $("#dodatum").val() == "") {
                    $("#erorrr").html("Pretraga po datumu: makar jedna vrednost mora biti popunjene.").css("color", "red");
                    return;
                }
                var data =
                    {
                        IdKorisnika: login_user.Id,
                        Dodatni: t,
                        Pretraga: JSON.parse(localStorage.getItem("pretraga")),
                        Stavka1: $("#oddatum").val(),
                        Stavka2: $("#dodatum").val()
                    }
                $.post("/api/main/podatumuoddo", data, function (data, status) {
                    if (status == "success") {
                        $("#erorrr").html("");
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in data) {
                            table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (data[t].Odrediste != null) {
                                if (data[t].Odrediste.Adresa != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                            } else
                                table += "null";
                            table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                            var date = data[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + data[t].Iznos + "</td><td>";
                            if (data[t].Komentar != null)
                                if (data[t].Komentar.OcenaVoznje != null)
                                    table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (data[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (data[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (data[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (data[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (data[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (data[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (data[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (data[t].StatusVoznje != "0")
                                table += " disabled ";

                            table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                            if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        $("#maintable").html(table);
                        localStorage.setItem("pretraga", JSON.stringify(data));
                        localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });

            $(document).on("click", "#po_oceni_oddo", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var t = false;
                if (localStorage.getItem("sveVoznje") != null || localStorage.getItem("slobodneVoznje") != null) {
                    t = true;
                }
                if (isNaN(parseInt($("#ocenaod").val())) && isNaN(parseInt($("#ocenado").val()))) {
                    $("#erorrr").html("Pretraga po oceni: makar jedna vrednost mora biti popunjene i brojevi.").css("color", "red");
                    return;
                }
                if (!isNaN(parseInt($("#ocenaod").val())) && !isNaN(parseInt($("#ocenado").val()))) {
                    if (parseInt($("#ocenaod").val()) > parseInt($("#ocenado").val())) {
                        $("#erorrr").html("Pretraga po oceni: prva vrednost(od) mora biti niža ili jednaka kao druga vrednost(do).").css("color", "red");
                        return;
                    }
                }
                var data =
                    {
                        IdKorisnika: login_user.Id,
                        Dodatni: t,
                        Pretraga: JSON.parse(localStorage.getItem("pretraga")),
                        Stavka1: $("#ocenaod").val(),
                        Stavka2: $("#ocenado").val()
                    }
                $.post("/api/main/poocenioddo", data, function (data, status) {
                    if (status == "success") {
                        $("#erorrr").html("");
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in data) {
                            table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (data[t].Odrediste != null) {
                                if (data[t].Odrediste.Adresa != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                            } else
                                table += "null";
                            table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                            var date = data[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + data[t].Iznos + "</td><td>";
                            if (data[t].Komentar != null)
                                if (data[t].Komentar.OcenaVoznje != null)
                                    table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (data[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (data[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (data[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (data[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (data[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (data[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (data[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (data[t].StatusVoznje != "0")
                                table += " disabled ";

                            table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                            if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        $("#maintable").html(table);
                        localStorage.setItem("pretraga", JSON.stringify(data));
                        localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });

            $(document).on("click", "#po_ceni_oddo", function () {
                var login_user = JSON.parse(localStorage.getItem("loginuser"));
                var t = false;
                if (localStorage.getItem("sveVoznje") != null || localStorage.getItem("slobodneVoznje") != null) {
                    t = true;
                }

                if (isNaN(parseInt($("#odcena").val())) && isNaN(parseInt($("#docena").val()))) {
                    $("#erorrr").html("Pretraga po ceni: obe vrednosti moraju biti popunjene i brojevi.").css("color", "red");
                    return;
                }
                if (!isNaN(parseInt($("#odcena").val())) && !isNaN(parseInt($("#docena").val()))) {
                    if (parseInt($("#odcena").val()) > parseInt($("#docena").val())) {
                        $("#erorrr").html("Pretraga po ceni: prva vrednost(od) mora biti niža ili jednaka kao druga vrednost(do).").css("color", "red");
                        return;
                    }
                }

                var data =
                    {
                        IdKorisnika: login_user.Id,
                        Dodatni: t,
                        Pretraga: JSON.parse(localStorage.getItem("pretraga")),
                        Stavka1: $("#odcena").val(),
                        Stavka2: $("#docena").val()
                    }
                $.post("/api/main/pocenioddo", data, function (data, status) {
                    if (status == "success") {
                        $("#erorrr").html("");
                        var table = "<tr><th>Polazna tačka</th><th>Odredište</th><th>Mušterija</th><th>Vozač</th><th>Dispečer</th><th>Datum i vreme</th><th>Cena</th><th>Ocena</th><th>Status vožnje</th><th>&nbsp;</th><th>&nbsp;</th></tr>";
                        for (t in data) {
                            table += "<tr><td>" + data[t].PolaznaTacka.Adresa.Ulica_broj + ", " + data[t].PolaznaTacka.Adresa.Mesto + "</td><td>";
                            if (data[t].Odrediste != null) {
                                if (data[t].Odrediste.Adresa != null)
                                    table += data[t].Odrediste.Adresa.Ulica_broj + ", " + data[t].Odrediste.Adresa.Mesto;
                                else
                                    table += "null";
                            } else
                                table += "null";
                            table += "</td><td>" + data[t].Musterija + "</td><td>" + data[t].Vozac + "</td><td>" + data[t].Dispecer + "</td><td>";

                            var date = data[t].VremePorudjbine.split("T");
                            var time = date[1].split(".");
                            table += date[0] + " ~ " + time[0];

                            table += "</td><td>" + data[t].Iznos + "</td><td>";
                            if (data[t].Komentar != null)
                                if (data[t].Komentar.OcenaVoznje != null)
                                    table += data[t].Komentar.OcenaVoznje + "</td><td>";
                                else
                                    table += "0</td><td>";
                            else
                                table += "0</td><td>";

                            if (data[t].StatusVoznje == "1") {
                                table += "Formirana";
                            }
                            else if (data[t].StatusVoznje == "2") {
                                table += "Obrađena";
                            }
                            else if (data[t].StatusVoznje == "3") {
                                table += "Prihvaćena";
                            }
                            else if (data[t].StatusVoznje == "4") {
                                table += "Otkazana";
                            }
                            else if (data[t].StatusVoznje == "5") {
                                table += "Neuspešna";
                            }
                            else if (data[t].StatusVoznje == "6") {
                                table += "Uspešna";
                            }
                            else if (data[t].StatusVoznje == "0") {
                                table += "Kreirana";
                            }

                            table += "</td><td><input type=\"submit\"";
                            if (data[t].StatusVoznje != "0")
                                table += " disabled ";

                            table += "name=\"obrada_voznje\" id=\"" + data[t].Id + "\" value=\"";
                            if (data.Uloga == "2" && data.Voznje[t].StatusVoznje == "0")
                                table += "Preuzmi";
                            else
                                table += "Obrada vožnje";
                            table += "\" /></td><td><input type=\"submit\" name=\"detalji_voznje\" id=\"" + data[t].Id + "\" value=\"Detalji vožnje\" /></td></tr>";
                        }
                        $("#maintable").html(table);
                        localStorage.setItem("pretraga", JSON.stringify(data));
                        localStorage.setItem("screen", $("#screen").html());
                    }
                });
            });
        });
    </script>
</head>
<body>
    <div class="Naslov">Taksi služba</div>
    <div id="mainmanu" class="Meni">
        <table>
            <tr>
                <td name="menu" id="login">Uloguj se</td>
                <td>|</td>
                <td name="menu" id="register">Registracija</td>
            </tr>
        </table>
    </div>
      
    <br /><br /><br />
    <div id="screen">
    <div class="Centar" id="screenin">
          <div id="error1" class="Red"></div>
          Korisničko ime:<br /> <input type="text" id="username" /><br />
          Lozinka:<br /> <input type="password" id="password" /><br />
          <input type="submit" id="log_in" value="Uloguj se" />
    </div>
    </div>
</body>
</html>